!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t((e=e||self).BoardgameIO={},e.React)}(this,(function(e,t){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function d(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function h(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function y(e){return function(){var t,n=u(e);if(f()){var r=u(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return h(this,t)}}function m(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=g(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o,i=!0,s=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return i=e.done,e},e:function(e){s=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw o}}}}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var w=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t=n("observable"),n.observable=t):t="@@observable",t}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),x=function(){return Math.random().toString(36).substring(7).split("").join(".")},k={INIT:"@@redux/INIT"+x(),REPLACE:"@@redux/REPLACE"+x(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+x()}};function C(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function $(e,t,n){var r;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n($)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var o=e,i=t,s=[],a=s,c=!1;function l(){a===s&&(a=s.slice())}function u(){if(c)throw new Error("You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function p(e){if("function"!=typeof e)throw new Error("Expected the listener to be a function.");if(c)throw new Error("You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api-reference/store#subscribelistener for more details.");var t=!0;return l(),a.push(e),function(){if(t){if(c)throw new Error("You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api-reference/store#subscribelistener for more details.");t=!1,l();var n=a.indexOf(e);a.splice(n,1),s=null}}}function f(e){if(!C(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,i=o(i,e)}finally{c=!1}for(var t=s=a,n=0;n<t.length;n++){(0,t[n])()}return e}function d(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");o=e,f({type:k.REPLACE})}function h(){var e,t=p;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new TypeError("Expected the observer to be an object.");function n(){e.next&&e.next(u())}return n(),{unsubscribe:t(n)}}})[w]=function(){return this},e}return f({type:k.INIT}),(r={dispatch:f,subscribe:p,getState:u,replaceReducer:d})[w]=h,r}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function O(e,t){var n=Object.keys(e);return Object.getOwnPropertySymbols&&n.push.apply(n,Object.getOwnPropertySymbols(e)),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(n,!0).forEach((function(t){P(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}function D(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),r=function(){throw new Error("Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},o={getState:n.getState,dispatch:function(){return r.apply(void 0,arguments)}},i=t.map((function(e){return e(o)}));return I({},n,{dispatch:r=E.apply(void 0,i)(n.dispatch)})}}}const A=(e,t,n,r)=>({type:"MAKE_MOVE",payload:{type:e,args:t,playerID:n,credentials:r}}),S=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r}}),_=(e,t,n,r)=>({type:"GAME_EVENT",payload:{type:e,args:t,playerID:n,credentials:r},automatic:!0}),j=e=>({type:"SYNC",state:e.state,log:e.log,initialState:e.initialState,clientOnly:!0}),N=(e,t)=>({type:"UPDATE",state:e,deltalog:t,clientOnly:!0}),B=e=>({type:"RESET",state:e,clientOnly:!0}),F=()=>({type:"UNDO"}),M=()=>({type:"REDO"});var T,R,q,z=Object.freeze({__proto__:null,makeMove:A,gameEvent:S,automaticGameEvent:_,sync:j,update:N,reset:B,undo:F,redo:M,plugin:(e,t,n,r)=>({type:"PLUGIN",payload:{type:e,args:t,playerID:n,credentials:r}})}),L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},U=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),G="undefined"!=typeof Symbol?Symbol("immer-nothing"):(q=!0,(R="immer-nothing")in(T={})?Object.defineProperty(T,R,{value:q,enumerable:!0,configurable:!0,writable:!0}):T[R]=q,T),H="undefined"!=typeof Symbol?Symbol("immer-draftable"):"__$immer_draftable",V="undefined"!=typeof Symbol?Symbol("immer-state"):"__$immer_state";function J(e){return!!e&&!!e[V]}function K(e){if(!e||"object"!==(void 0===e?"undefined":L(e)))return!1;if(Array.isArray(e))return!0;var t=Object.getPrototypeOf(e);return!t||t===Object.prototype||(!!e[H]||!!e.constructor[H])}var W=Object.assign||function(e,t){for(var n in t)ee(t,n)&&(e[n]=t[n]);return e},Y="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function X(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Array.isArray(e))return e.slice();var n=Object.create(Object.getPrototypeOf(e));return Y(e).forEach((function(r){if(r!==V){var o=Object.getOwnPropertyDescriptor(e,r);if(o.get){if(!t)throw new Error("Immer drafts cannot have computed properties");o.value=o.get.call(e)}o.enumerable?n[r]=o.value:Object.defineProperty(n,r,{value:o.value,writable:!0,configurable:!0})}})),n}function Z(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(n,e[n],e);else Y(e).forEach((function(n){return t(n,e[n],e)}))}function Q(e,t){return Object.getOwnPropertyDescriptor(e,t).enumerable}function ee(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function te(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}var ne={},re=[],oe=function(){return re[re.length-1]};function ie(e,t){var n=Array.isArray(e),r=ue(e);Z(r,(function(t){!function(e,t,n){var r=ne[t];r?r.enumerable=n:ne[t]=r={configurable:!0,enumerable:n,get:function(){return function(e,t){pe(e);var n=ae(e)[t];if(!e.finalizing&&n===e.base[t]&&K(n))return le(e),e.copy[t]=ie(n,e);return n}(this[V],t)},set:function(e){!function(e,t,n){if(pe(e),e.assigned[t]=!0,!e.modified){if(te(ae(e)[t],n))return;ce(e),le(e)}e.copy[t]=n}(this[V],t,e)}};Object.defineProperty(e,t,r)}(r,t,n||Q(e,t))}));var o={scope:t?t.scope:oe(),modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:t,base:e,draft:r,copy:null,revoke:se,revoked:!1};return function(e,t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!0})}(r,V,o),o.scope.push(o),r}function se(){this.revoked=!0}function ae(e){return e.copy||e.base}function ce(e){e.modified||(e.modified=!0,e.parent&&ce(e.parent))}function le(e){e.copy||(e.copy=ue(e.base))}function ue(e){var t=e&&e[V];if(t){t.finalizing=!0;var n=X(t.draft,!0);return t.finalizing=!1,n}return X(e)}function pe(e){if(!0===e.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(ae(e)))}function fe(e){for(var t=e.base,n=e.draft,r=Object.keys(n),o=r.length-1;o>=0;o--)if(void 0===t[r[o]]&&!ee(t,r[o]))return!0;return r.length!==Object.keys(t).length}function de(e){var t=e.draft;if(t.length!==e.base.length)return!0;var n=Object.getOwnPropertyDescriptor(t,t.length-1);return!(!n||n.get)}var he=Object.freeze({scopes:re,currentScope:oe,willFinalize:function(e,t,n){var r=oe();r.forEach((function(e){return e.finalizing=!0})),void 0!==e&&e!==t||(n&&function e(t){if(!t||"object"!==(void 0===t?"undefined":L(t)))return;var n=t[V];if(!n)return;var r=n.base,o=n.draft,i=n.assigned;if(Array.isArray(t)){if(de(n)){if(ce(n),i.length=!0,o.length<r.length)for(var s=o.length;s<r.length;s++)i[s]=!1;else for(var a=r.length;a<o.length;a++)i[a]=!0;for(var c=0;c<o.length;c++)void 0===i[c]&&e(o[c])}}else Object.keys(o).forEach((function(t){void 0!==r[t]||ee(r,t)?i[t]||e(o[t]):(i[t]=!0,ce(n))})),Object.keys(r).forEach((function(e){void 0!==o[e]||ee(o,e)||(i[e]=!1,ce(n))}))}(t),function(e){for(var t=e.length-1;t>=0;t--){var n=e[t];!1===n.modified&&(Array.isArray(n.base)?de(n)&&ce(n):fe(n)&&ce(n))}}(r))},createDraft:ie}),ye=[],me=function(){return ye[ye.length-1]};function ge(e,t){var n={scope:t?t.scope:me(),modified:!1,finalized:!1,assigned:{},parent:t,base:e,draft:null,drafts:{},copy:null,revoke:null},r=Array.isArray(e)?Proxy.revocable([n],be):Proxy.revocable(n,ve),o=r.revoke,i=r.proxy;return n.draft=i,n.revoke=o,n.scope.push(n),i}var ve={get:function(e,t){if(t===V)return e;var n=e.drafts;if(!e.modified&&ee(n,t))return n[t];var r=we(e)[t];if(e.finalized||!K(r))return r;if(e.modified){if(r!==e.base[t])return r;n=e.copy}return n[t]=ge(r,e)},has:function(e,t){return t in we(e)},ownKeys:function(e){return Reflect.ownKeys(we(e))},set:function(e,t,n){if(!e.modified){if(n?te(e.base[t],n)||n===e.drafts[t]:te(e.base[t],n)&&t in e.base)return!0;xe(e)}return e.assigned[t]=!0,e.copy[t]=n,!0},deleteProperty:function(e,t){(void 0!==e.base[t]||t in e.base)&&(e.assigned[t]=!1,xe(e));e.copy&&delete e.copy[t];return!0},getOwnPropertyDescriptor:function(e,t){var n=we(e),r=Reflect.getOwnPropertyDescriptor(n,t);r&&(r.writable=!0,r.configurable=!Array.isArray(n)||"length"!==t);return r},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(e){return Object.getPrototypeOf(e.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},be={};function we(e){return e.copy||e.base}function xe(e){e.modified||(e.modified=!0,e.copy=W(X(e.base),e.drafts),e.drafts=null,e.parent&&xe(e.parent))}Z(ve,(function(e,t){be[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),be.deleteProperty=function(e,t){if(isNaN(parseInt(t)))throw new Error("Immer only supports deleting array indices");return ve.deleteProperty.call(this,e[0],t)},be.set=function(e,t,n){if("length"!==t&&isNaN(parseInt(t)))throw new Error("Immer only supports setting array indices and the 'length' property");return ve.set.call(this,e[0],t,n)};var ke=Object.freeze({scopes:ye,currentScope:me,willFinalize:function(){},createDraft:ge});function Ce(e,t,n,r){Array.isArray(e.base)?function(e,t,n,r){for(var o=e.base,i=e.copy,s=e.assigned,a=Math.min(o.length,i.length),c=0;c<a;c++)if(s[c]&&o[c]!==i[c]){var l=t.concat(c);n.push({op:"replace",path:l,value:i[c]}),r.push({op:"replace",path:l,value:o[c]})}if(a<i.length){for(var u=a;u<i.length;u++)n.push({op:"add",path:t.concat(u),value:i[u]});r.push({op:"replace",path:t.concat("length"),value:o.length})}else if(a<o.length){n.push({op:"replace",path:t.concat("length"),value:i.length});for(var p=a;p<o.length;p++)r.push({op:"add",path:t.concat(p),value:o[p]})}}(e,t,n,r):function(e,t,n,r){var o=e.base,i=e.copy;Z(e.assigned,(function(e,s){var a=o[e],c=i[e],l=s?e in o?"replace":"add":"remove";if(a!==c||"replace"!==l){var u=t.concat(e);n.push("remove"===l?{op:l,path:u}:{op:l,path:u,value:c}),r.push("add"===l?{op:"remove",path:u}:"remove"===l?{op:"add",path:u,value:a}:{op:"replace",path:u,value:a})}}))}(e,t,n,r)}function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n],o=r.path;if(0===o.length&&"replace"===r.op)e=r.value;else{for(var i=e,s=0;s<o.length-1;s++)if(!(i=i[o[s]])||"object"!==(void 0===i?"undefined":L(i)))throw new Error("Cannot apply patch, path doesn't resolve: "+o.join("/"));var a=o[o.length-1];switch(r.op){case"replace":case"add":i[a]=r.value;break;case"remove":if(Array.isArray(i)){if(a!==i.length-1)throw new Error("Only the last index of an array can be removed, index: "+a+", length: "+i.length);i.length-=1}else delete i[a];break;default:throw new Error("Unsupported patch operation: "+r.op)}}}return e}var Pe={useProxies:"undefined"!=typeof Proxy&&"undefined"!=typeof Reflect,autoFreeze:"undefined"==typeof process&&"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},Oe=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),W(this,Pe,t),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this)}return U(e,[{key:"produce",value:function(e,t,n){var r=this;if("function"==typeof e&&"function"!=typeof t){var o=t;return t=e,function(){for(var e=arguments.length,n=Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o;return r.produce(s,(function(e){var r;return(r=t).call.apply(r,[e,e].concat(n))}))}}if("function"!=typeof t)throw new Error("if first argument is not a function, the second argument to produce should be a function");if(void 0!==n&&"function"!=typeof n)throw new Error("the third argument of a producer should not be set or a function");var i=void 0;if(K(e)){this.scopes.push([]);var s=this.createDraft(e);try{i=t.call(s,s),this.willFinalize(i,s,!!n);var a=n&&[],c=n&&[];if(void 0===i||i===s)i=this.finalize(s,[],a,c);else{if(s[V].modified)throw new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");K(i)&&(i=this.finalize(i)),n&&(a.push({op:"replace",path:[],value:i}),c.push({op:"replace",path:[],value:e}))}}finally{this.currentScope().forEach((function(e){return e.revoke()})),this.scopes.pop()}n&&n(a,c)}else if(void 0===(i=t(e)))return e;return i===G?void 0:i}},{key:"setAutoFreeze",value:function(e){this.autoFreeze=e}},{key:"setUseProxies",value:function(e){this.useProxies=e,W(this,e?ke:he)}},{key:"applyPatches",value:function(e,t){return J(e)?$e(e,t):this.produce(e,(function(e){return $e(e,t)}))}},{key:"finalize",value:function(e,t,n,r){var o=this,i=e[V];if(!i)return Object.isFrozen(e)?e:this.finalizeTree(e);if(i.scope!==this.currentScope())return e;if(!i.modified)return i.base;if(!i.finalized){if(i.finalized=!0,this.finalizeTree(i.draft,t,n,r),this.onDelete)if(this.useProxies){var s=i.assigned;for(var a in s)s[a]||this.onDelete(i,a)}else{var c=i.base,l=i.copy;Z(c,(function(e){ee(l,e)||o.onDelete(i,e)}))}this.onCopy&&this.onCopy(i),this.autoFreeze&&1===this.scopes.length&&Object.freeze(i.copy),n&&Ce(i,t,n,r)}return i.copy}},{key:"finalizeTree",value:function(e,t,n,r){var o=this,i=e[V];i&&(this.useProxies||(i.finalizing=!0,i.copy=X(i.draft,!0),i.finalizing=!1),e=i.copy);var s=this.onAssign;return Z(e,(function a(c,l,u){if(l===u)throw Error("Immer forbids circular references");var p=!!i&&u===e;if(J(l)){if(l=n&&p&&!i.assigned[c]?o.finalize(l,t.concat(c),n,r):o.finalize(l),Array.isArray(u)||Q(u,c)?u[c]=l:Object.defineProperty(u,c,{value:l}),p&&l===i.base[c])return}else{if(p&&te(l,i.base[c]))return;K(l)&&!Object.isFrozen(l)&&Z(l,a)}p&&s&&s(i,c,l)})),e}}]),e}()),Ie=Oe.produce;Oe.setAutoFreeze.bind(Oe),Oe.setUseProxies.bind(Oe),Oe.applyPatches.bind(Oe);const Ee={name:"plugin-immer",fnWrap:e=>Ie(e)};function De(e){var t=this,n=function(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function Ae(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function Se(e,t){var r=new De(e),o=t&&t.state,i=r.next;return i.quick=i,o&&("object"==n(o)&&Ae(o,r),i.state=function(){return Ae(r,{})}),i}var _e=function(){function e(t){r(this,e),this.state=t,this.used=!1}return i(e,[{key:"isUsed",value:function(){return this.used}},{key:"getState",value:function(){return this.state}},{key:"_random",value:function(){this.used=!0;var e,t=this.state,n=(e=void 0===t.prngstate?new Se(t.seed,{state:!0}):new Se("",{state:t.prngstate}))();return this.state=c({},t,{prngstate:e.state()}),n}},{key:"api",value:function(){var e=this._random.bind(this),t={D4:4,D6:6,D8:8,D10:10,D12:12,D20:20},n={},r=function(r){var o=t[r];n[r]=function(t){return void 0===t?Math.floor(e()*o)+1:m(new Array(t).keys()).map((function(){return Math.floor(e()*o)+1}))}};for(var o in t)r(o);return c({},n,{Die:function(t,n){return void 0===t&&(t=6),void 0===n?Math.floor(e()*t)+1:m(new Array(n).keys()).map((function(){return Math.floor(e()*t)+1}))},Number:function(){return e()},Shuffle:function(t){for(var n=t.slice(0),r=t.length,o=0,i=new Array(r);r;){var s=r*e()|0;i[o++]=n[s],n[s]=n[--r]}return i},_obj:this})}}]),e}();_e.seed=function(){return(+new Date).toString(36).slice(-10)};const je={name:"random",noClient:({api:e})=>e._obj.isUsed(),flush:({api:e})=>e._obj.getState(),api:({data:e})=>new _e(e).api(),setup:({game:e})=>{let t=e.seed;return void 0===t&&(t=_e.seed()),{seed:t}}};class Ne{constructor(e,t){this.flow=e,this.playerID=t,this.dispatch=[]}api(e){const t={_obj:this},{phase:n,turn:r}=e;for(const e of this.flow.eventNames)t[e]=(...t)=>{this.dispatch.push({key:e,args:t,phase:n,turn:r})};return t}isUsed(){return this.dispatch.length>0}update(e){for(let t=0;t<this.dispatch.length;t++){const n=this.dispatch[t];if("endTurn"===n.key&&n.turn!==e.ctx.turn)continue;if(("endPhase"===n.key||"setPhase"===n.key)&&n.phase!==e.ctx.phase)continue;const r=_(n.key,n.args,this.playerID);e={...e,...this.flow.processEvent(e,r)}}return e}}const Be=[Ee,je,{name:"events",noClient:({api:e})=>e._obj.isUsed(),dangerouslyFlushRawState:({state:e,api:t})=>t._obj.update(e),api:({game:e,playerID:t,ctx:n})=>new Ne(e.flow,t).api(n)}],Fe=e=>{let t={...e.ctx};const n=e.plugins||{};return Object.entries(n).forEach(([e,{api:n}])=>{t[e]=n}),t},Me=(e,t)=>[...Be,...t].filter(e=>void 0!==e.fnWrap).reduce((e,{fnWrap:t})=>t(e),e),Te=(e,t)=>([...Be,...t.game.plugins].filter(e=>void 0!==e.api).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},i=n.api({G:e.G,ctx:e.ctx,data:o.data,game:t.game,playerID:t.playerID});e={...e,plugins:{...e.plugins,[r]:{...o,api:i}}}}),e),Re=(e,t)=>([...Be,...t.game.plugins].forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}};if(n.flush){const r=n.flush({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data});e={...e,plugins:{...e.plugins,[n.name]:{data:r}}}}else if(n.dangerouslyFlushRawState){const i=(e=n.dangerouslyFlushRawState({state:e,game:t.game,api:o.api,data:o.data})).plugins[r].data;e={...e,plugins:{...e.plugins,[n.name]:{data:i}}}}}),e),qe=console.log,ze=console.error;function Le(e){ze("ERROR:",e)}function Ue(e,t,n){return{...e,ctx:Ge(e.ctx,n)}}function Ge(e,t){let{_prevActivePlayers:n}=e,r={},o=null,i={};if(Array.isArray(t)){let e={};t.forEach(t=>e[t]=Ke.NULL),r=e}else{if(t.next&&(o=t.next),n=t.revert?n.concat({activePlayers:e.activePlayers,_activePlayersMoveLimit:e._activePlayersMoveLimit,_activePlayersNumMoves:e._activePlayersNumMoves}):[],void 0!==t.currentPlayer&&He(r,i,e.currentPlayer,t.currentPlayer),void 0!==t.others)for(let n=0;n<e.playOrder.length;n++){const o=e.playOrder[n];o!==e.currentPlayer&&He(r,i,o,t.others)}if(void 0!==t.all)for(let n=0;n<e.playOrder.length;n++){He(r,i,e.playOrder[n],t.all)}if(t.value)for(const e in t.value)He(r,i,e,t.value[e]);if(t.moveLimit)for(const e in r)void 0===i[e]&&(i[e]=t.moveLimit)}0==Object.keys(r).length&&(r=null),0==Object.keys(i).length&&(i=null);let s={};for(const e in r)s[e]=0;return{...e,activePlayers:r,_activePlayersMoveLimit:i,_activePlayersNumMoves:s,_prevActivePlayers:n,_nextActivePlayers:o}}function He(e,t,n,r){"object"==typeof r&&r!==Ke.NULL||(r={stage:r}),void 0!==r.stage&&(e[n]=r.stage,r.moveLimit&&(t[n]=r.moveLimit))}function Ve(e,t){return e[t]+""}const Je={DEFAULT:{first:(e,t)=>0===t.turn?t.playOrderPos:(t.playOrderPos+1)%t.playOrder.length,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},RESET:{first:()=>0,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},CONTINUE:{first:(e,t)=>t.playOrderPos,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length},ONCE:{first:()=>0,next:(e,t)=>{if(t.playOrderPos<t.playOrder.length-1)return t.playOrderPos+1}},CUSTOM:e=>({playOrder:()=>e,first:()=>0,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length}),CUSTOM_FROM:e=>({playOrder:t=>t[e],first:()=>0,next:(e,t)=>(t.playOrderPos+1)%t.playOrder.length})},Ke={NULL:null};function We({moves:e,phases:t,endIf:n,onEnd:r,turn:o,events:i,plugins:s}){void 0===e&&(e={}),void 0===i&&(i={}),void 0===s&&(s=[]),void 0===t&&(t={}),n||(n=()=>{}),r||(r=e=>e),o||(o={});const a={...t};""in a&&Le("cannot specify phase with empty name"),a[""]={};let c={},l=new Set,u=null;Object.keys(e).forEach(e=>l.add(e));const p=e=>{const t=Me(e,s);return e=>{const n=Fe(e);return t(e.G,n)}},f=e=>t=>{let n=Fe(t);return e(t.G,n)},d={onEnd:p(r),endIf:f(n)};for(let e in a){const t=a[e];if(!0===t.start&&(u=e),void 0!==t.moves)for(let n of Object.keys(t.moves))c[e+"."+n]=t.moves[n],l.add(n);void 0===t.endIf&&(t.endIf=()=>{}),void 0===t.onBegin&&(t.onBegin=e=>e),void 0===t.onEnd&&(t.onEnd=e=>e),void 0===t.turn&&(t.turn=o),void 0===t.turn.order&&(t.turn.order=Je.DEFAULT),void 0===t.turn.onBegin&&(t.turn.onBegin=e=>e),void 0===t.turn.onEnd&&(t.turn.onEnd=e=>e),void 0===t.turn.endIf&&(t.turn.endIf=()=>!1),void 0===t.turn.onMove&&(t.turn.onMove=e=>e),void 0===t.turn.stages&&(t.turn.stages={});for(const n in t.turn.stages){const r=t.turn.stages[n].moves||{};for(let t of Object.keys(r)){c[e+"."+n+"."+t]=r[t],l.add(t)}}t.wrapped={onBegin:p(t.onBegin),onEnd:p(t.onEnd),endIf:f(t.endIf)},t.turn.wrapped={onMove:p(t.turn.onMove),onBegin:p(t.turn.onBegin),onEnd:p(t.turn.onEnd),endIf:f(t.turn.endIf)}}function h(e){return e.phase?a[e.phase]:a[""]}function y(e){return e}function m(e,t){const n=new Set,r=new Set;for(let o=0;o<t.length;o++){const{fn:i,arg:s,...a}=t[o];if(i===I){r.clear();const t=e.ctx.phase;if(n.has(t)){const t={...e.ctx,phase:null};return{...e,ctx:t}}n.add(t)}let c=[];if(e=i(e,{...a,arg:s,next:c}),i===O)break;const l=C(e);if(l){t.push({fn:O,arg:l,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}const u=$(e);if(u)t.push({fn:I,arg:u,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});else{if(i===y){const n=P(e);if(n){t.push({fn:E,arg:n,turn:e.ctx.turn,phase:e.ctx.phase,automatic:!0});continue}}t.push(...c)}}return e}function g(e,{next:t}){return t.push({fn:v}),e}function v(e,{next:t}){let{G:n,ctx:r}=e;return n=h(r).wrapped.onBegin(e),t.push({fn:b}),{...e,G:n,ctx:r}}function b(e,{currentPlayer:t}){let{G:n,ctx:r}=e;const o=h(r);t?(r={...r,currentPlayer:t},o.turn.activePlayers&&(r=Ge(r,o.turn.activePlayers))):r=function(e,t,n){const r=n.order;let o=[...new Array(t.numPlayers)].map((e,t)=>t+"");void 0!==r.playOrder&&(o=r.playOrder(e,t));const i=r.first(e,t),s=typeof i;"number"!==s&&Le(`invalid value returned by turn.order.first — expected number got ${s} “${i}”.`);const a=Ve(o,i);return t=Ge(t={...t,currentPlayer:a,playOrderPos:i,playOrder:o},n.activePlayers||{})}(n,r,o.turn);const i=r.turn+1;r={...r,turn:i,numMoves:0,_prevActivePlayers:[]},n=o.turn.wrapped.onBegin({...e,G:n,ctx:r});const s=[{G:n,ctx:r}];return{...e,G:n,ctx:r,_undo:s,_redo:[]}}function w(e,{arg:t,next:n,phase:r}){const o=h({phase:r});let{ctx:i}=e;if(t&&t.next){if(!(t.next in a))return Le("invalid phase: "+t.next),e;i={...i,phase:t.next}}else i=void 0!==o.next?{...i,phase:o.next}:{...i,phase:null};return e={...e,ctx:i},n.push({fn:v}),e}function x(e,{arg:t,currentPlayer:n,next:r}){let{G:o,ctx:i}=e;const s=h(i),{endPhase:a,ctx:c}=function(e,t,n,r){const o=n.order;let i=t.playOrderPos,s=t.currentPlayer,a=!1;if(r&&!0!==r)"object"!=typeof r&&Le("invalid argument to endTurn: "+r),Object.keys(r).forEach(e=>{switch(e){case"remove":s=Ve(t.playOrder,i);break;case"next":i=t.playOrder.indexOf(r.next),s=r.next;break;default:Le("invalid argument to endTurn: "+e)}});else{const n=o.next(e,t),r=typeof n;void 0!==n&&"number"!==r&&Le(`invalid value returned by turn.order.next — expected number or undefined, got ${r} “${n}”.`),void 0===n?a=!0:(i=n,s=Ve(t.playOrder,i))}return{endPhase:a,ctx:t={...t,playOrderPos:i,currentPlayer:s}}}(o,{...i,currentPlayer:n},s.turn,t);return i=c,e={...e,G:o,ctx:i},a?r.push({fn:I,turn:i.turn,phase:i.phase}):r.push({fn:b,currentPlayer:i.currentPlayer}),e}function k(e,{arg:t,playerID:n}){"string"==typeof t&&(t={stage:t});let{ctx:r}=e,{activePlayers:o,_activePlayersMoveLimit:i,_activePlayersNumMoves:s}=r;return t.stage&&(null===o&&(o={}),o[n]=t.stage,s[n]=0,t.moveLimit&&(null===i&&(i={}),i[n]=t.moveLimit)),r={...r,activePlayers:o,_activePlayersMoveLimit:i,_activePlayersNumMoves:s},{...e,ctx:r}}function C(e){return d.endIf(e)}function $(e){return h(e.ctx).wrapped.endIf(e)}function P(e){const t=h(e.ctx),n=e.ctx.numMoves||0;return!!(t.turn.moveLimit&&n>=t.turn.moveLimit)||t.turn.wrapped.endIf(e)}function O(e,{arg:t,phase:n}){e=I(e,{phase:n}),void 0===t&&(t=!0),e={...e,ctx:{...e.ctx,gameover:t}};const r=d.onEnd(e);return{...e,G:r}}function I(e,{arg:t,next:n,turn:r,automatic:o}){let i=(e=E(e,{turn:r,force:!0})).G,s=e.ctx;if(n&&n.push({fn:w,arg:t,phase:s.phase}),null===s.phase)return e;i=h(s).wrapped.onEnd(e),s={...s,phase:null};const a={action:S("endPhase",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};o&&(a.automatic=!0);const c=[...e.deltalog,a];return{...e,G:i,ctx:s,deltalog:c}}function E(e,{arg:t,next:n,turn:r,force:o,automatic:i,playerID:s}){if(r!==e.ctx.turn)return e;let{G:a,ctx:c}=e;const l=h(c),u=c.numMoves||0;if(!o&&l.turn.moveLimit&&u<l.turn.moveLimit)return p=`cannot end turn before making ${l.turn.moveLimit} moves`,qe("INFO: "+p),e;var p;if(a=l.turn.wrapped.onEnd(e),n&&n.push({fn:x,arg:t,currentPlayer:c.currentPlayer}),c={...c,activePlayers:null},t&&t.remove){s=s||c.currentPlayer;const t=c.playOrder.filter(e=>e!=s),r=c.playOrderPos>t.length-1?0:c.playOrderPos;if(c={...c,playOrder:t,playOrderPos:r},0===t.length)return n.push({fn:I,turn:c.turn,phase:c.phase}),e}const f={action:S("endTurn",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};i&&(f.automatic=!0);const d=[...e.deltalog||[],f];return{...e,G:a,ctx:c,deltalog:d,_undo:[],_redo:[]}}function D(e,{arg:t,next:n,automatic:r,playerID:o}){o=o||e.ctx.currentPlayer;let{ctx:i}=e,{activePlayers:s,_activePlayersMoveLimit:a}=i;const c=null!==s&&o in s;if(!t&&c){const e=h(i).turn.stages[s[o]];e&&e.next&&(t=e.next)}if(n&&t&&n.push({fn:k,arg:t,playerID:o}),!c)return e;s=Object.keys(s).filter(e=>e!==o).reduce((e,t)=>(e[t]=s[t],e),{}),a&&(a=Object.keys(a).filter(e=>e!==o).reduce((e,t)=>(e[t]=a[t],e),{})),i=function(e){let{activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e;if(t&&0==Object.keys(t).length)if(e._nextActivePlayers)e=Ge(e,e._nextActivePlayers),({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}=e);else if(o.length>0){const e=o.length-1;({activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r}=o[e]),o=o.slice(0,e)}else t=null,n=null;return{...e,activePlayers:t,_activePlayersMoveLimit:n,_activePlayersNumMoves:r,_prevActivePlayers:o}}({...i,activePlayers:s,_activePlayersMoveLimit:a});const l={action:S("endStage",t),_stateID:e._stateID,turn:e.ctx.turn,phase:e.ctx.phase};r&&(l.automatic=!0);const u=[...e.deltalog||[],l];return{...e,ctx:i,deltalog:u}}const A={endStage:function(e,t){return m(e,[{fn:D,playerID:t}])},setStage:function(e,t,n){return m(e,[{fn:D,arg:n,playerID:t}])},endTurn:function(e,t,n){return m(e,[{fn:E,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},pass:function(e,t,n){return m(e,[{fn:E,turn:e.ctx.turn,phase:e.ctx.phase,force:!0,arg:n}])},endPhase:function(e){return m(e,[{fn:I,phase:e.ctx.phase,turn:e.ctx.turn}])},setPhase:function(e,t,n){return m(e,[{fn:I,phase:e.ctx.phase,turn:e.ctx.turn,arg:{next:n}}])},endGame:function(e,t,n){return m(e,[{fn:O,turn:e.ctx.turn,phase:e.ctx.phase,arg:n}])},setActivePlayers:Ue};let _=[];return!1!==i.endTurn&&_.push("endTurn"),!1!==i.pass&&_.push("pass"),!1!==i.endPhase&&_.push("endPhase"),!1!==i.setPhase&&_.push("setPhase"),!1!==i.endGame&&_.push("endGame"),!1!==i.setActivePlayers&&_.push("setActivePlayers"),!1!==i.endStage&&_.push("endStage"),!1!==i.setStage&&_.push("setStage"),{ctx:e=>({numPlayers:e,turn:0,currentPlayer:"0",playOrder:[...new Array(e)].map((e,t)=>t+""),playOrderPos:0,phase:u,activePlayers:null}),init:e=>m(e,[{fn:g}]),isPlayerActive:function(e,t,n){return t.activePlayers?n in t.activePlayers:t.currentPlayer===n},eventHandlers:A,eventNames:Object.keys(A),enabledEventNames:_,moveMap:c,moveNames:[...l.values()],processMove:function(e,t){let n=h(e.ctx),{ctx:r}=e,{_activePlayersNumMoves:o}=r;const{playerID:i}=t;r.activePlayers&&o[i]++;let s=e.ctx.numMoves;i==e.ctx.currentPlayer&&s++,e={...e,ctx:{...r,numMoves:s,_activePlayersNumMoves:o}},r._activePlayersMoveLimit&&o[i]>=r._activePlayersMoveLimit[i]&&(e=D(e,{playerID:i,automatic:!0}));const a=n.turn.wrapped.onMove(e),c=(e={...e,G:a})._undo||[],l=t.type;return m(e={...e,_undo:[...c,{G:e.G,ctx:e.ctx,moveType:l}],_redo:[]},[{fn:y}])},processEvent:function(e,t){const{type:n,playerID:r,args:o}=t.payload;if(A.hasOwnProperty(n)){const t=[e,r].concat(o);return A[n].apply({},t)}return e},getMove:function(t,n,r){const o=h(t),i=o.turn.stages,{activePlayers:s}=t;if(s&&void 0!==s[r]&&s[r]!==Ke.NULL&&void 0!==i[s[r]]&&void 0!==i[s[r]].moves){const e=i[s[r]].moves;if(n in e)return e[n]}else if(o.moves){if(n in o.moves)return o.moves[n]}else if(n in e)return e[n];return null}}}function Ye(e){if(function(e){return void 0!==e.processMove}(e))return e;if(void 0===e.name&&(e.name="default"),void 0===e.setup&&(e.setup=()=>({})),void 0===e.moves&&(e.moves={}),void 0===e.playerView&&(e.playerView=e=>e),void 0===e.plugins&&(e.plugins=[]),e.plugins.forEach(e=>{if(void 0===e.name)throw new Error("Plugin missing name attribute");if(e.name.includes(" "))throw new Error(e.name+": Plugin name must not include spaces")}),e.name.includes(" "))throw new Error(e.name+": Game name must not include spaces");const t=We(e);return{...e,flow:t,moveNames:t.moveNames,pluginNames:e.plugins.map(e=>e.name),processMove:(n,r)=>{let o=t.getMove(n.ctx,r.type,r.playerID);var i;if((i=o)instanceof Object&&void 0!==i.move&&(o=o.move),o instanceof Function){const t=Me(o,e.plugins),i={...Fe(n),playerID:r.playerID};let s=[];return void 0!==r.args&&(s=s.concat(r.args)),t(n.G,i,...s)}return Le("invalid move object: "+r.type),n.G}}}function Xe(){}const Ze=e=>e;function Qe(e,t){for(const n in t)e[n]=t[n];return e}function et(e){return e()}function tt(){return Object.create(null)}function nt(e){e.forEach(et)}function rt(e){return"function"==typeof e}function ot(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function it(e,...t){if(null==e)return Xe;const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function st(e,t,n){e.$$.on_destroy.push(it(t,n))}function at(e,t,n,r){return e[1]&&r?Qe(n.ctx.slice(),e[1](r(t))):n.ctx}function ct(e){const t={};for(const n in e)"$"!==n[0]&&(t[n]=e[n]);return t}const lt="undefined"!=typeof window;let ut=lt?()=>window.performance.now():()=>Date.now(),pt=lt?e=>requestAnimationFrame(e):Xe;const ft=new Set;function dt(e){ft.forEach(t=>{t.c(e)||(ft.delete(t),t.f())}),0!==ft.size&&pt(dt)}function ht(e,t){e.appendChild(t)}function yt(e,t,n){e.insertBefore(t,n||null)}function mt(e){e.parentNode.removeChild(e)}function gt(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function vt(e){return document.createElement(e)}function bt(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function wt(e){return document.createTextNode(e)}function xt(){return wt(" ")}function kt(){return wt("")}function Ct(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function $t(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Pt(e,t){t=""+t,e.data!==t&&(e.data=t)}function Ot(e,t){(null!=t||e.value)&&(e.value=t)}function It(e,t){for(let n=0;n<e.options.length;n+=1){const r=e.options[n];if(r.__value===t)return void(r.selected=!0)}}function Et(e,t,n){e.classList[n?"add":"remove"](t)}function Dt(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}const At=new Set;let St,_t=0;function jt(e,t,n,r,o,i,s,a=0){const c=16.666/r;let l="{\n";for(let e=0;e<=1;e+=c){const r=t+(n-t)*i(e);l+=100*e+`%{${s(r,1-r)}}\n`}const u=l+`100% {${s(n,1-n)}}\n}`,p=`__svelte_${function(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}(u)}_${a}`,f=e.ownerDocument;At.add(f);const d=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(vt("style")).sheet),h=f.__svelte_rules||(f.__svelte_rules={});h[p]||(h[p]=!0,d.insertRule(`@keyframes ${p} ${u}`,d.cssRules.length));const y=e.style.animation||"";return e.style.animation=`${y?y+", ":""}${p} ${r}ms linear ${o}ms 1 both`,_t+=1,p}function Nt(e,t){const n=(e.style.animation||"").split(", "),r=n.filter(t?e=>e.indexOf(t)<0:e=>-1===e.indexOf("__svelte")),o=n.length-r.length;o&&(e.style.animation=r.join(", "),_t-=o,_t||pt(()=>{_t||(At.forEach(e=>{const t=e.__svelte_stylesheet;let n=t.cssRules.length;for(;n--;)t.deleteRule(n);e.__svelte_rules={}}),At.clear())}))}function Bt(e){St=e}function Ft(){if(!St)throw new Error("Function called outside component initialization");return St}function Mt(e){Ft().$$.on_destroy.push(e)}function Tt(){const e=Ft();return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=Dt(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}function Rt(e,t){Ft().$$.context.set(e,t)}function qt(e){return Ft().$$.context.get(e)}const zt=[],Lt=[],Ut=[],Gt=[],Ht=Promise.resolve();let Vt=!1;function Jt(e){Ut.push(e)}let Kt=!1;const Wt=new Set;function Yt(){if(!Kt){Kt=!0;do{for(let e=0;e<zt.length;e+=1){const t=zt[e];Bt(t),Xt(t.$$)}for(zt.length=0;Lt.length;)Lt.pop()();for(let e=0;e<Ut.length;e+=1){const t=Ut[e];Wt.has(t)||(Wt.add(t),t())}Ut.length=0}while(zt.length);for(;Gt.length;)Gt.pop()();Vt=!1,Kt=!1,Wt.clear()}}function Xt(e){if(null!==e.fragment){e.update(),nt(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Jt)}}let Zt;function Qt(e,t,n){e.dispatchEvent(Dt(`${t?"intro":"outro"}${n}`))}const en=new Set;let tn;function nn(){tn={r:0,c:[],p:tn}}function rn(){tn.r||nt(tn.c),tn=tn.p}function on(e,t){e&&e.i&&(en.delete(e),e.i(t))}function sn(e,t,n,r){if(e&&e.o){if(en.has(e))return;en.add(e),tn.c.push(()=>{en.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}}const an={duration:0};function cn(e,t,n,r){let o=t(e,n),i=r?0:1,s=null,a=null,c=null;function l(){c&&Nt(e,c)}function u(e,t){const n=e.b-i;return t*=Math.abs(n),{a:i,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function p(t){const{delay:n=0,duration:r=300,easing:p=Ze,tick:f=Xe,css:d}=o||an,h={start:ut()+n,b:t};t||(h.group=tn,tn.r+=1),s?a=h:(d&&(l(),c=jt(e,i,t,r,n,p,d)),t&&f(0,1),s=u(h,r),Jt(()=>Qt(e,t,"start")),function(e){let t;0===ft.size&&pt(dt),new Promise(n=>{ft.add(t={c:e,f:n})})}(t=>{if(a&&t>a.start&&(s=u(a,r),a=null,Qt(e,s.b,"start"),d&&(l(),c=jt(e,i,s.b,s.duration,0,p,o.css))),s)if(t>=s.end)f(i=s.b,1-i),Qt(e,s.b,"end"),a||(s.b?l():--s.group.r||nt(s.group.c)),s=null;else if(t>=s.start){const e=t-s.start;i=s.a+s.d*p(e/s.duration),f(i,1-i)}return!(!s&&!a)}))}return{run(e){rt(o)?(Zt||(Zt=Promise.resolve(),Zt.then(()=>{Zt=null})),Zt).then(()=>{o=o(),p(e)}):p(e)},end(){l(),s=a=null}}}function ln(e){e&&e.c()}function un(e,t,n){const{fragment:r,on_mount:o,on_destroy:i,after_update:s}=e.$$;r&&r.m(t,n),Jt(()=>{const t=o.map(et).filter(rt);i?i.push(...t):nt(t),e.$$.on_mount=[]}),s.forEach(Jt)}function pn(e,t){const n=e.$$;null!==n.fragment&&(nt(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function fn(e,t){-1===e.$$.dirty[0]&&(zt.push(e),Vt||(Vt=!0,Ht.then(Yt)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function dn(e,t,n,r,o,i,s=[-1]){const a=St;Bt(e);const c=t.props||{},l=e.$$={fragment:null,ctx:null,props:i,update:Xe,not_equal:o,bound:tt(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:tt(),dirty:s};let u=!1;if(l.ctx=n?n(e,c,(t,n,...r)=>{const i=r.length?r[0]:n;return l.ctx&&o(l.ctx[t],l.ctx[t]=i)&&(l.bound[t]&&l.bound[t](i),u&&fn(e,t)),n}):[],l.update(),u=!0,nt(l.before_update),l.fragment=!!r&&r(l.ctx),t.target){if(t.hydrate){const e=function(e){return Array.from(e.childNodes)}(t.target);l.fragment&&l.fragment.l(e),e.forEach(mt)}else l.fragment&&l.fragment.c();t.intro&&on(e.$$.fragment),un(e,t.target,t.anchor),Yt()}Bt(a)}class hn{$destroy(){pn(this,1),this.$destroy=Xe}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}const yn=[];function mn(e,t=Xe){let n;const r=[];function o(t){if(ot(e,t)&&(e=t,n)){const t=!yn.length;for(let t=0;t<r.length;t+=1){const n=r[t];n[1](),yn.push(n,e)}if(t){for(let e=0;e<yn.length;e+=2)yn[e][0](yn[e+1]);yn.length=0}}}return{set:o,update:function(t){o(t(e))},subscribe:function(i,s=Xe){const a=[i,s];return r.push(a),1===r.length&&(n=t(o)||Xe),i(e),()=>{const e=r.indexOf(a);-1!==e&&r.splice(e,1),0===r.length&&(n(),n=null)}}}}function gn(e){const t=e-1;return t*t*t+1}function vn(e,{delay:t=0,duration:n=400,easing:r=gn,x:o=0,y:i=0,opacity:s=0}){const a=getComputedStyle(e),c=+a.opacity,l="none"===a.transform?"":a.transform,u=c*(1-s);return{delay:t,duration:n,easing:r,css:(e,t)=>`\n\t\t\ttransform: ${l} translate(${(1-e)*o}px, ${(1-e)*i}px);\n\t\t\topacity: ${c-u*t}`}}function bn(e,t,n){const r=e.slice();return r[4]=t[n][0],r[5]=t[n][1].label,r}function wn(e){let t,n,r,o,i=e[5]+"";function s(...t){return e[3](e[4],...t)}return{c(){t=vt("div"),n=wt(i),r=xt(),$t(t,"class","menu-item svelte-19bfq8g"),Et(t,"active",e[0]==e[4])},m(e,i,a){yt(e,t,i),ht(t,n),ht(t,r),a&&o(),o=Ct(t,"click",s)},p(r,o){e=r,2&o&&i!==(i=e[5]+"")&&Pt(n,i),3&o&&Et(t,"active",e[0]==e[4])},d(e){e&&mt(t),o()}}}function xn(e){let t,n=Object.entries(e[1]).reverse(),r=[];for(let t=0;t<n.length;t+=1)r[t]=wn(bn(e,n,t));return{c(){t=vt("div");for(let e=0;e<r.length;e+=1)r[e].c();$t(t,"class","menu svelte-19bfq8g")},m(e,n){yt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,[o]){if(7&o){let i;for(n=Object.entries(e[1]).reverse(),i=0;i<n.length;i+=1){const s=bn(e,n,i);r[i]?r[i].p(s,o):(r[i]=wn(s),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:Xe,o:Xe,d(e){e&&mt(t),gt(r,e)}}}function kn(e,t,n){let{pane:r}=t,{panes:o}=t;const i=Tt();return e.$set=e=>{"pane"in e&&n(0,r=e.pane),"panes"in e&&n(1,o=e.panes)},[r,o,i,e=>i("change",e)]}class Cn extends hn{constructor(e){var t;super(),document.getElementById("svelte-19bfq8g-style")||((t=vt("style")).id="svelte-19bfq8g-style",t.textContent=".menu.svelte-19bfq8g{display:flex;margin-top:-10px;flex-direction:row;border:1px solid #ccc;border-radius:5px 5px 0 0;height:25px;line-height:25px;margin-right:-500px;transform-origin:bottom right;transform:rotate(-90deg) translate(0, -500px)}.menu-item.svelte-19bfq8g{line-height:25px;cursor:pointer;background:#fefefe;color:#555;padding-left:15px;padding-right:15px;text-align:center}.menu-item.svelte-19bfq8g:last-child{border-radius:0 5px 0 0}.menu-item.svelte-19bfq8g:first-child{border-radius:5px 0 0 0}.menu-item.active.svelte-19bfq8g{cursor:default;font-weight:bold;background:#ddd;color:#555}.menu-item.svelte-19bfq8g:hover{background:#ddd;color:#555}",ht(document.head,t)),dn(this,e,kn,xn,ot,{pane:0,panes:1})}}function $n(e){let t,n;return{c(){t=vt("div"),n=wt(e[1]),$t(t,"class","label svelte-1olzq4i")},m(e,r){yt(e,t,r),ht(t,n)},p(e,t){2&t&&Pt(n,e[1])},d(e){e&&mt(t)}}}function Pn(e){let t,n,r,o,i,s=e[1]&&$n(e);return{c(){t=vt("div"),n=vt("div"),r=wt(e[0]),o=xt(),s&&s.c(),$t(n,"class","key-box svelte-1olzq4i"),$t(t,"class","key svelte-1olzq4i"),Et(t,"active",e[2])},m(a,c,l){yt(a,t,c),ht(t,n),ht(n,r),ht(t,o),s&&s.m(t,null),l&&nt(i),i=[Ct(window,"keydown",e[5]),Ct(n,"click",e[4])]},p(e,[n]){1&n&&Pt(r,e[0]),e[1]?s?s.p(e,n):(s=$n(e),s.c(),s.m(t,null)):s&&(s.d(1),s=null),4&n&&Et(t,"active",e[2])},i:Xe,o:Xe,d(e){e&&mt(t),s&&s.d(),nt(i)}}}function On(e,t,n){let r,{value:o}=t,{onPress:i=null}=t,{label:s=null}=t,{disable:a=!1}=t;const{disableHotkeys:c}=qt("hotkeys");st(e,c,e=>n(8,r=e));let l=!1;function u(){n(2,l=!1)}function p(){n(2,l=!0),setTimeout(u,200),i&&setTimeout(i,1)}return e.$set=e=>{"value"in e&&n(0,o=e.value),"onPress"in e&&n(6,i=e.onPress),"label"in e&&n(1,s=e.label),"disable"in e&&n(7,a=e.disable)},[o,s,l,c,p,function(e){r||a||e.key!=o||(e.preventDefault(),p())},i,a]}class In extends hn{constructor(e){var t;super(),document.getElementById("svelte-1olzq4i-style")||((t=vt("style")).id="svelte-1olzq4i-style",t.textContent=".key.svelte-1olzq4i.svelte-1olzq4i{display:flex;flex-direction:row;align-items:center}.key-box.svelte-1olzq4i.svelte-1olzq4i{cursor:pointer;min-width:10px;padding-left:5px;padding-right:5px;height:20px;line-height:20px;text-align:center;border:1px solid #ccc;box-shadow:1px 1px 1px #888;background:#eee;color:#444}.key-box.svelte-1olzq4i.svelte-1olzq4i:hover{background:#ddd}.key.active.svelte-1olzq4i .key-box.svelte-1olzq4i{background:#ddd;border:1px solid #999;box-shadow:none}.label.svelte-1olzq4i.svelte-1olzq4i{margin-left:10px}",ht(document.head,t)),dn(this,e,On,Pn,ot,{value:0,onPress:6,label:1,disable:7})}}function En(e){let t,n,r,o,i,s;return{c(){t=vt("div"),n=wt(e[2]),r=wt("("),o=vt("span"),i=wt(")"),$t(o,"class","arg-field svelte-khot71"),$t(o,"contenteditable",""),$t(t,"class","move svelte-khot71"),Et(t,"active",e[3])},m(a,c,l){yt(a,t,c),ht(t,n),ht(t,r),ht(t,o),e[9](o),ht(t,i),l&&nt(s),s=[Ct(o,"blur",(function(){rt(e[1])&&e[1].apply(this,arguments)})),Ct(o,"keydown",e[5]),Ct(t,"click",(function(){rt(e[0])&&e[0].apply(this,arguments)}))]},p(r,[o]){e=r,4&o&&Pt(n,e[2]),8&o&&Et(t,"active",e[3])},i:Xe,o:Xe,d(n){n&&mt(t),e[9](null),nt(s)}}}function Dn(e,t,n){let r,{Activate:o}=t,{Deactivate:i}=t,{name:s}=t,{active:a}=t;const c=Tt();function l(){try{const e=r.innerText;let t=new Function(`return [${e}]`)();c("submit",t)}catch(e){c("error",e)}n(4,r.innerText="",r)}var u;return u=()=>{a?r.focus():r.blur()},Ft().$$.after_update.push(u),e.$set=e=>{"Activate"in e&&n(0,o=e.Activate),"Deactivate"in e&&n(1,i=e.Deactivate),"name"in e&&n(2,s=e.name),"active"in e&&n(3,a=e.active)},[o,i,s,a,r,function(e){"Enter"==e.key&&(e.preventDefault(),l()),"Escape"==e.key&&(e.preventDefault(),i())},void 0,c,l,function(e){Lt[e?"unshift":"push"](()=>{n(4,r=e)})}]}class An extends hn{constructor(e){var t;super(),document.getElementById("svelte-khot71-style")||((t=vt("style")).id="svelte-khot71-style",t.textContent=".move.svelte-khot71{cursor:pointer;margin-left:10px;color:#666}.move.svelte-khot71:hover{color:#333}.move.active.svelte-khot71{color:#111;font-weight:bold}.arg-field.svelte-khot71{outline:none;font-family:monospace}",ht(document.head,t)),dn(this,e,Dn,En,ot,{Activate:0,Deactivate:1,name:2,active:3})}}function Sn(e){let t,n;return{c(){t=vt("span"),n=wt(e[2]),$t(t,"class","move-error svelte-smqssc")},m(e,r){yt(e,t,r),ht(t,n)},p(e,t){4&t&&Pt(n,e[2])},d(e){e&&mt(t)}}}function _n(e){let t,n,r,o,i;const s=new In({props:{value:e[0],onPress:e[4]}}),a=new An({props:{Activate:e[4],Deactivate:e[5],name:e[1],active:e[3]}});a.$on("submit",e[6]),a.$on("error",e[7]);let c=e[2]&&Sn(e);return{c(){t=vt("div"),n=vt("div"),ln(s.$$.fragment),r=xt(),ln(a.$$.fragment),o=xt(),c&&c.c(),$t(n,"class","wrapper svelte-smqssc")},m(e,l){yt(e,t,l),ht(t,n),un(s,n,null),ht(n,r),un(a,n,null),ht(t,o),c&&c.m(t,null),i=!0},p(e,[n]){const r={};1&n&&(r.value=e[0]),s.$set(r);const o={};2&n&&(o.name=e[1]),8&n&&(o.active=e[3]),a.$set(o),e[2]?c?c.p(e,n):(c=Sn(e),c.c(),c.m(t,null)):c&&(c.d(1),c=null)},i(e){i||(on(s.$$.fragment,e),on(a.$$.fragment,e),i=!0)},o(e){sn(s.$$.fragment,e),sn(a.$$.fragment,e),i=!1},d(e){e&&mt(t),pn(s),pn(a),c&&c.d()}}}function jn(e,t,n){let{shortcut:r}=t,{name:o}=t,{fn:i}=t;const{disableHotkeys:s}=qt("hotkeys");let a="",c=!1;function l(){s.set(!1),n(2,a=""),n(3,c=!1)}return e.$set=e=>{"shortcut"in e&&n(0,r=e.shortcut),"name"in e&&n(1,o=e.name),"fn"in e&&n(8,i=e.fn)},[r,o,a,c,function(){s.set(!0),n(3,c=!0)},l,function(e){n(2,a=""),l(),i.apply(this,e.detail)},function(e){n(2,a=e.detail),Le(e.detail)},i]}class Nn extends hn{constructor(e){var t;super(),document.getElementById("svelte-smqssc-style")||((t=vt("style")).id="svelte-smqssc-style",t.textContent=".move-error.svelte-smqssc{color:#a00;font-weight:bold}.wrapper.svelte-smqssc{display:flex;flex-direction:row;align-items:center}",ht(document.head,t)),dn(this,e,jn,_n,ot,{shortcut:0,name:1,fn:8})}}var Bn=function(e,t){return{parse:function(t){var n=JSON.parse(t,o).map(r),i=n[0];return"object"==typeof i&&i?function t(n,r,o){return Object.keys(o).reduce((function(o,i){var s=o[i];if(s instanceof e){var a=n[s];"object"!=typeof a||r.has(a)?o[i]=a:(r.add(a),o[i]=t(n,r,a))}return o}),o)}(n,new Set,i):i},stringify:function(e){for(var t,r=new Map,o=[],i=[],s=+n(r,o,e),a=function(e,i){if(t)return t=!t,i;switch(typeof i){case"object":if(null===i)return i;case"string":return r.get(i)||n(r,o,i)}return i};s<o.length;s++)t=!0,i[s]=JSON.stringify(o[s],a);return"["+i.join(",")+"]"}};function n(t,n,r){var o=e(n.push(r)-1);return t.set(r,o),o}function r(t){return t instanceof e?e(t):t}function o(t,n){return"string"==typeof n?new e(n):n}}(String);const Fn=Bn.parse,Mn=Bn.stringify;function Tn(e){let t,n,r,o,i,s,a,c,l;const u=new In({props:{value:"1",onPress:e[0].reset,label:"reset"}}),p=new In({props:{value:"2",onPress:e[1],label:"save"}}),f=new In({props:{value:"3",onPress:e[2],label:"restore"}}),d=new In({props:{value:".",disable:!0,label:"hide"}});return{c(){t=vt("section"),n=vt("li"),ln(u.$$.fragment),r=xt(),o=vt("li"),ln(p.$$.fragment),i=xt(),s=vt("li"),ln(f.$$.fragment),a=xt(),c=vt("li"),ln(d.$$.fragment),$t(n,"class","svelte-1x2w9i0"),$t(o,"class","svelte-1x2w9i0"),$t(s,"class","svelte-1x2w9i0"),$t(c,"class","svelte-1x2w9i0"),$t(t,"id","debug-controls"),$t(t,"class","controls")},m(e,h){yt(e,t,h),ht(t,n),un(u,n,null),ht(t,r),ht(t,o),un(p,o,null),ht(t,i),ht(t,s),un(f,s,null),ht(t,a),ht(t,c),un(d,c,null),l=!0},p(e,[t]){const n={};1&t&&(n.onPress=e[0].reset),u.$set(n)},i(e){l||(on(u.$$.fragment,e),on(p.$$.fragment,e),on(f.$$.fragment,e),on(d.$$.fragment,e),l=!0)},o(e){sn(u.$$.fragment,e),sn(p.$$.fragment,e),sn(f.$$.fragment,e),sn(d.$$.fragment,e),l=!1},d(e){e&&mt(t),pn(u),pn(p),pn(f),pn(d)}}}function Rn(e,t,n){let{client:r}=t;return e.$set=e=>{"client"in e&&n(0,r=e.client)},[r,function(){const{G:e,ctx:t}=r.getState(),n=Mn({G:e,ctx:t});window.localStorage.setItem("gamestate",n)},function(){const e=window.localStorage.getItem("gamestate");if(null!==e){const t=Fn(e);r.store.dispatch(j(t))}}]}class qn extends hn{constructor(e){var t;super(),document.getElementById("svelte-1x2w9i0-style")||((t=vt("style")).id="svelte-1x2w9i0-style",t.textContent="li.svelte-1x2w9i0{list-style:none;margin:none;margin-bottom:5px}",ht(document.head,t)),dn(this,e,Rn,Tn,ot,{client:0})}}function zn(e,t,n){const r=e.slice();return r[6]=t[n],r}function Ln(e){let t,n,r,o,i=e[6]+"";function s(...t){return e[5](e[6],...t)}return{c(){t=vt("div"),n=wt(i),r=xt(),$t(t,"class","player svelte-6sf87x"),Et(t,"current",e[6]==e[0].currentPlayer),Et(t,"active",e[6]==e[1])},m(e,i,a){yt(e,t,i),ht(t,n),ht(t,r),a&&o(),o=Ct(t,"click",s)},p(r,o){e=r,4&o&&i!==(i=e[6]+"")&&Pt(n,i),5&o&&Et(t,"current",e[6]==e[0].currentPlayer),6&o&&Et(t,"active",e[6]==e[1])},d(e){e&&mt(t),o()}}}function Un(e){let t,n=e[2],r=[];for(let t=0;t<n.length;t+=1)r[t]=Ln(zn(e,n,t));return{c(){t=vt("div");for(let e=0;e<r.length;e+=1)r[e].c();$t(t,"class","player-box svelte-6sf87x")},m(e,n){yt(e,t,n);for(let e=0;e<r.length;e+=1)r[e].m(t,null)},p(e,[o]){if(15&o){let i;for(n=e[2],i=0;i<n.length;i+=1){const s=zn(e,n,i);r[i]?r[i].p(s,o):(r[i]=Ln(s),r[i].c(),r[i].m(t,null))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:Xe,o:Xe,d(e){e&&mt(t),gt(r,e)}}}function Gn(e,t,n){let{ctx:r}=t,{playerID:o}=t;const i=Tt();function s(e){i("change",e==o?{playerID:null}:{playerID:e})}let a;return e.$set=e=>{"ctx"in e&&n(0,r=e.ctx),"playerID"in e&&n(1,o=e.playerID)},e.$$.update=()=>{1&e.$$.dirty&&n(2,a=r?[...Array(r.numPlayers).keys()].map(e=>e.toString()):[])},[r,o,a,s,i,e=>s(e)]}class Hn extends hn{constructor(e){var t;super(),document.getElementById("svelte-6sf87x-style")||((t=vt("style")).id="svelte-6sf87x-style",t.textContent=".player-box.svelte-6sf87x{display:flex;flex-direction:row}.player.svelte-6sf87x{cursor:pointer;text-align:center;width:30px;height:30px;line-height:30px;background:#eee;border:3px solid #fefefe;box-sizing:content-box}.player.current.svelte-6sf87x{background:#555;color:#eee;font-weight:bold}.player.active.svelte-6sf87x{border:3px solid #ff7f50}",ht(document.head,t)),dn(this,e,Gn,Un,ot,{ctx:0,playerID:1})}}function Vn(e,t,n){const r=e.slice();return r[9]=t[n][0],r[10]=t[n][1],r}function Jn(e){let t,n,r;const o=new Nn({props:{shortcut:e[4][e[9]],fn:e[10],name:e[9]}});return{c(){t=vt("li"),ln(o.$$.fragment),n=xt(),$t(t,"class","svelte-1vg2l2b")},m(e,i){yt(e,t,i),un(o,t,null),ht(t,n),r=!0},p(e,t){const n={};1&t&&(n.shortcut=e[4][e[9]]),1&t&&(n.fn=e[10]),1&t&&(n.name=e[9]),o.$set(n)},i(e){r||(on(o.$$.fragment,e),r=!0)},o(e){sn(o.$$.fragment,e),r=!1},d(e){e&&mt(t),pn(o)}}}function Kn(e){let t,n;return{c(){t=vt("button"),t.textContent="End Turn",$t(t,"class","svelte-1vg2l2b")},m(r,o,i){yt(r,t,o),i&&n(),n=Ct(t,"click",e[6])},p:Xe,d(e){e&&mt(t),n()}}}function Wn(e){let t,n;return{c(){t=vt("button"),t.textContent="End Phase",$t(t,"class","svelte-1vg2l2b")},m(r,o,i){yt(r,t,o),i&&n(),n=Ct(t,"click",e[7])},p:Xe,d(e){e&&mt(t),n()}}}function Yn(e){let t,n;return{c(){t=vt("button"),t.textContent="End Stage",$t(t,"class","svelte-1vg2l2b")},m(r,o,i){yt(r,t,o),i&&n(),n=Ct(t,"click",e[8])},p:Xe,d(e){e&&mt(t),n()}}}function Xn(e){let t,n,r,o,i,s,a,c,l,u,p,f,d,h,y,m,g,v,b,w,x,k,C,$,P,O,I,E,D,A,S,_=JSON.stringify(e[3],null,2)+"",j=JSON.stringify(Zn(e[2]),null,2)+"";const N=new qn({props:{client:e[0]}}),B=new Hn({props:{ctx:e[2],playerID:e[1]}});B.$on("change",e[5]);let F=Object.entries(e[0].moves),M=[];for(let t=0;t<F.length;t+=1)M[t]=Jn(Vn(e,F,t));const T=e=>sn(M[e],1,1,()=>{M[e]=null});let R=e[0].events.endTurn&&Kn(e),q=e[2].phase&&e[0].events.endPhase&&Wn(e),z=e[2].activePlayers&&e[0].events.endStage&&Yn(e);return{c(){t=vt("section"),n=vt("h3"),n.textContent="Controls",r=xt(),ln(N.$$.fragment),o=xt(),i=vt("section"),s=vt("h3"),s.textContent="Players",a=xt(),ln(B.$$.fragment),c=xt(),l=vt("section"),u=vt("h3"),u.textContent="Moves",p=xt();for(let e=0;e<M.length;e+=1)M[e].c();f=xt(),d=vt("section"),h=vt("h3"),h.textContent="Events",y=xt(),m=vt("div"),R&&R.c(),g=xt(),q&&q.c(),v=xt(),z&&z.c(),b=xt(),w=vt("section"),x=vt("label"),x.textContent="G",k=xt(),C=vt("pre"),$=wt(_),P=xt(),O=vt("section"),I=vt("label"),I.textContent="ctx",E=xt(),D=vt("pre"),A=wt(j),$t(n,"class","svelte-1vg2l2b"),$t(s,"class","svelte-1vg2l2b"),$t(u,"class","svelte-1vg2l2b"),$t(h,"class","svelte-1vg2l2b"),$t(m,"class","events svelte-1vg2l2b"),$t(x,"class","svelte-1vg2l2b"),$t(C,"class","json svelte-1vg2l2b"),$t(I,"class","svelte-1vg2l2b"),$t(D,"class","json svelte-1vg2l2b")},m(e,_){yt(e,t,_),ht(t,n),ht(t,r),un(N,t,null),yt(e,o,_),yt(e,i,_),ht(i,s),ht(i,a),un(B,i,null),yt(e,c,_),yt(e,l,_),ht(l,u),ht(l,p);for(let e=0;e<M.length;e+=1)M[e].m(l,null);yt(e,f,_),yt(e,d,_),ht(d,h),ht(d,y),ht(d,m),R&&R.m(m,null),ht(m,g),q&&q.m(m,null),ht(m,v),z&&z.m(m,null),yt(e,b,_),yt(e,w,_),ht(w,x),ht(w,k),ht(w,C),ht(C,$),yt(e,P,_),yt(e,O,_),ht(O,I),ht(O,E),ht(O,D),ht(D,A),S=!0},p(e,[t]){const n={};1&t&&(n.client=e[0]),N.$set(n);const r={};if(4&t&&(r.ctx=e[2]),2&t&&(r.playerID=e[1]),B.$set(r),17&t){let n;for(F=Object.entries(e[0].moves),n=0;n<F.length;n+=1){const r=Vn(e,F,n);M[n]?(M[n].p(r,t),on(M[n],1)):(M[n]=Jn(r),M[n].c(),on(M[n],1),M[n].m(l,null))}for(nn(),n=F.length;n<M.length;n+=1)T(n);rn()}e[0].events.endTurn?R?R.p(e,t):(R=Kn(e),R.c(),R.m(m,g)):R&&(R.d(1),R=null),e[2].phase&&e[0].events.endPhase?q?q.p(e,t):(q=Wn(e),q.c(),q.m(m,v)):q&&(q.d(1),q=null),e[2].activePlayers&&e[0].events.endStage?z?z.p(e,t):(z=Yn(e),z.c(),z.m(m,null)):z&&(z.d(1),z=null),(!S||8&t)&&_!==(_=JSON.stringify(e[3],null,2)+"")&&Pt($,_),(!S||4&t)&&j!==(j=JSON.stringify(Zn(e[2]),null,2)+"")&&Pt(A,j)},i(e){if(!S){on(N.$$.fragment,e),on(B.$$.fragment,e);for(let e=0;e<F.length;e+=1)on(M[e]);S=!0}},o(e){sn(N.$$.fragment,e),sn(B.$$.fragment,e),M=M.filter(Boolean);for(let e=0;e<M.length;e+=1)sn(M[e]);S=!1},d(e){e&&mt(t),pn(N),e&&mt(o),e&&mt(i),pn(B),e&&mt(c),e&&mt(l),gt(M,e),e&&mt(f),e&&mt(d),R&&R.d(),q&&q.d(),z&&z.d(),e&&mt(b),e&&mt(w),e&&mt(P),e&&mt(O)}}}function Zn(e){let t={};for(const n in e)n.startsWith("_")||(t[n]=e[n]);return t}function Qn(e,t,n){let{client:r}=t;const o=function(e,t,n){var r={},o={};for(var i in e)o[i]=i;for(var s in t)o[s]=s;for(var a={},c=0;c<n.length;c++){a[n[c]]=!0}var l=a,u=!0;for(var p in o){var f=p[0];if(l[f]){u=!1;break}l[f]=!0,r[p]=f}if(u)return r;l=a;var d=97;for(var h in r={},o){for(var y=String.fromCharCode(d);l[y];)d++,y=String.fromCharCode(d);l[y]=!0,r[h]=y}return r}(r.moves,r.events,"mlia");let i=r.playerID,s={},a={};r.subscribe(e=>{e&&(n(3,a=e.G),n(2,s=e.ctx)),n(1,i=r.playerID)});return e.$set=e=>{"client"in e&&n(0,r=e.client)},[r,i,s,a,o,e=>r.updatePlayerID(e.detail.playerID),()=>r.events.endTurn(),()=>r.events.endPhase(),()=>r.events.endStage()]}class er extends hn{constructor(e){var t;super(),document.getElementById("svelte-1vg2l2b-style")||((t=vt("style")).id="svelte-1vg2l2b-style",t.textContent=".json.svelte-1vg2l2b.svelte-1vg2l2b{font-family:monospace;color:#888}label.svelte-1vg2l2b.svelte-1vg2l2b{font-weight:bold;font-size:1.1em;display:inline}h3.svelte-1vg2l2b.svelte-1vg2l2b{text-transform:uppercase}li.svelte-1vg2l2b.svelte-1vg2l2b{list-style:none;margin:none;margin-bottom:5px}.events.svelte-1vg2l2b.svelte-1vg2l2b{display:flex;flex-direction:column}.events.svelte-1vg2l2b button.svelte-1vg2l2b{width:100px}.events.svelte-1vg2l2b button.svelte-1vg2l2b:not(:last-child){margin-bottom:10px}",ht(document.head,t)),dn(this,e,Qn,Xn,ot,{client:0})}}function tr(e){let t,n,r,o,i,s,a=JSON.stringify(e[1])+"";return{c(){t=vt("div"),n=vt("strong"),r=wt(e[0]),o=xt(),i=vt("div"),s=wt(a),$t(i,"class","svelte-13qih23"),$t(t,"class","item svelte-13qih23")},m(e,a){yt(e,t,a),ht(t,n),ht(n,r),ht(t,o),ht(t,i),ht(i,s)},p(e,[t]){1&t&&Pt(r,e[0]),2&t&&a!==(a=JSON.stringify(e[1])+"")&&Pt(s,a)},i:Xe,o:Xe,d(e){e&&mt(t)}}}function nr(e,t,n){let{name:r}=t,{value:o}=t;return e.$set=e=>{"name"in e&&n(0,r=e.name),"value"in e&&n(1,o=e.value)},[r,o]}class rr extends hn{constructor(e){var t;super(),document.getElementById("svelte-13qih23-style")||((t=vt("style")).id="svelte-13qih23-style",t.textContent=".item.svelte-13qih23.svelte-13qih23{padding:10px}.item.svelte-13qih23.svelte-13qih23:not(:first-child){border-top:1px dashed #aaa}.item.svelte-13qih23 div.svelte-13qih23{float:right;text-align:right}",ht(document.head,t)),dn(this,e,nr,tr,ot,{name:0,value:1})}}function or(e){let t,n,r;const o=new rr({props:{name:"isConnected",value:e[1].isConnected}}),i=new rr({props:{name:"isMultiplayer",value:e[1].isMultiplayer}});return{c(){t=vt("span"),ln(o.$$.fragment),n=xt(),ln(i.$$.fragment)},m(e,s){yt(e,t,s),un(o,t,null),ht(t,n),un(i,t,null),r=!0},p(e,t){const n={};2&t&&(n.value=e[1].isConnected),o.$set(n);const r={};2&t&&(r.value=e[1].isMultiplayer),i.$set(r)},i(e){r||(on(o.$$.fragment,e),on(i.$$.fragment,e),r=!0)},o(e){sn(o.$$.fragment,e),sn(i.$$.fragment,e),r=!1},d(e){e&&mt(t),pn(o),pn(i)}}}function ir(e){let t,n,r,o,i;const s=new rr({props:{name:"gameID",value:e[0].gameID}}),a=new rr({props:{name:"playerID",value:e[0].playerID}}),c=new rr({props:{name:"isActive",value:e[1].isActive}});let l=e[1].isMultiplayer&&or(e);return{c(){t=vt("section"),ln(s.$$.fragment),n=xt(),ln(a.$$.fragment),r=xt(),ln(c.$$.fragment),o=xt(),l&&l.c(),$t(t,"class","gameinfo svelte-1yzq5o8")},m(e,u){yt(e,t,u),un(s,t,null),ht(t,n),un(a,t,null),ht(t,r),un(c,t,null),ht(t,o),l&&l.m(t,null),i=!0},p(e,[n]){const r={};1&n&&(r.value=e[0].gameID),s.$set(r);const o={};1&n&&(o.value=e[0].playerID),a.$set(o);const i={};2&n&&(i.value=e[1].isActive),c.$set(i),e[1].isMultiplayer?l?(l.p(e,n),on(l,1)):(l=or(e),l.c(),on(l,1),l.m(t,null)):l&&(nn(),sn(l,1,1,()=>{l=null}),rn())},i(e){i||(on(s.$$.fragment,e),on(a.$$.fragment,e),on(c.$$.fragment,e),on(l),i=!0)},o(e){sn(s.$$.fragment,e),sn(a.$$.fragment,e),sn(c.$$.fragment,e),sn(l),i=!1},d(e){e&&mt(t),pn(s),pn(a),pn(c),l&&l.d()}}}function sr(e,t,n){let r,o=Xe,i=()=>(o(),o=it(s,e=>n(1,r=e)),s);e.$$.on_destroy.push(()=>o());let{client:s}=t;return i(),e.$set=e=>{"client"in e&&i(n(0,s=e.client))},[s,r]}class ar extends hn{constructor(e){var t;super(),document.getElementById("svelte-1yzq5o8-style")||((t=vt("style")).id="svelte-1yzq5o8-style",t.textContent=".gameinfo.svelte-1yzq5o8{padding:10px}",ht(document.head,t)),dn(this,e,sr,ir,ot,{client:0})}}function cr(e){let t,n;return{c(){t=vt("div"),n=wt(e[0]),$t(t,"class","turn-marker svelte-6eza86"),$t(t,"style",e[1])},m(e,r){yt(e,t,r),ht(t,n)},p(e,[t]){1&t&&Pt(n,e[0])},i:Xe,o:Xe,d(e){e&&mt(t)}}}function lr(e,t,n){let{turn:r}=t,{numEvents:o}=t;const i="grid-row: span "+o;return e.$set=e=>{"turn"in e&&n(0,r=e.turn),"numEvents"in e&&n(2,o=e.numEvents)},[r,i,o]}class ur extends hn{constructor(e){var t;super(),document.getElementById("svelte-6eza86-style")||((t=vt("style")).id="svelte-6eza86-style",t.textContent=".turn-marker.svelte-6eza86{display:flex;justify-content:center;align-items:center;grid-column:1;background:#555;color:#eee;text-align:center;font-weight:bold;border:1px solid #888}",ht(document.head,t)),dn(this,e,lr,cr,ot,{turn:0,numEvents:2})}}function pr(e){let t,n,r=(e[0]||"")+"";return{c(){t=vt("div"),n=wt(r),$t(t,"class","phase-marker svelte-1t4xap"),$t(t,"style",e[1])},m(e,r){yt(e,t,r),ht(t,n)},p(e,[t]){1&t&&r!==(r=(e[0]||"")+"")&&Pt(n,r)},i:Xe,o:Xe,d(e){e&&mt(t)}}}function fr(e,t,n){let{phase:r}=t,{numEvents:o}=t;const i="grid-row: span "+o;return e.$set=e=>{"phase"in e&&n(0,r=e.phase),"numEvents"in e&&n(2,o=e.numEvents)},[r,i,o]}class dr extends hn{constructor(e){var t;super(),document.getElementById("svelte-1t4xap-style")||((t=vt("style")).id="svelte-1t4xap-style",t.textContent=".phase-marker.svelte-1t4xap{grid-column:3;background:#555;border:1px solid #888;color:#eee;text-align:center;font-weight:bold;padding-top:10px;padding-bottom:10px;text-orientation:sideways;writing-mode:vertical-rl;line-height:30px;width:100%}",ht(document.head,t)),dn(this,e,fr,pr,ot,{phase:0,numEvents:2})}}function hr(e){let t;return{c(){t=vt("div"),t.textContent=""+e[0]},m(e,n){yt(e,t,n)},p:Xe,i:Xe,o:Xe,d(e){e&&mt(t)}}}function yr(e,t,n){let{payload:r}=t;const o=void 0!==r?JSON.stringify(r,null,4):"";return e.$set=e=>{"payload"in e&&n(1,r=e.payload)},[o,r]}class mr extends hn{constructor(e){super(),dn(this,e,yr,hr,ot,{payload:1})}}function gr(e){let t;const n=new mr({props:{payload:e[3]}});return{c(){ln(n.$$.fragment)},m(e,r){un(n,e,r),t=!0},p(e,t){const r={};8&t&&(r.payload=e[3]),n.$set(r)},i(e){t||(on(n.$$.fragment,e),t=!0)},o(e){sn(n.$$.fragment,e),t=!1},d(e){pn(n,e)}}}function vr(e){let t,n;var r=e[4];function o(e){return{props:{payload:e[3]}}}if(r)var i=new r(o(e));return{c(){i&&ln(i.$$.fragment),t=kt()},m(e,r){i&&un(i,e,r),yt(e,t,r),n=!0},p(e,n){const s={};if(8&n&&(s.payload=e[3]),r!==(r=e[4])){if(i){nn();const e=i;sn(e.$$.fragment,1,0,()=>{pn(e,1)}),rn()}r?(ln((i=new r(o(e))).$$.fragment),on(i.$$.fragment,1),un(i,t.parentNode,t)):i=null}else r&&i.$set(s)},i(e){n||(i&&on(i.$$.fragment,e),n=!0)},o(e){i&&sn(i.$$.fragment,e),n=!1},d(e){e&&mt(t),i&&pn(i,e)}}}function br(e){let t,n,r,o,i,s,a,c,l,u,p,f,d=e[1].payload.type+"",h=e[6].join(",")+"";const y=[vr,gr],m=[];function g(e,t){return e[4]?0:1}return c=g(e),l=m[c]=y[c](e),{c(){t=vt("div"),n=vt("div"),r=wt(d),o=wt("("),i=wt(h),s=wt(")"),a=xt(),l.c(),$t(t,"class",u="log-event player"+e[7]+" svelte-10wdo7v"),Et(t,"pinned",e[2])},m(l,u,d){yt(l,t,u),ht(t,n),ht(n,r),ht(n,o),ht(n,i),ht(n,s),ht(t,a),m[c].m(t,null),p=!0,d&&nt(f),f=[Ct(t,"click",e[8]),Ct(t,"mouseenter",e[9]),Ct(t,"mouseleave",e[10])]},p(e,[n]){(!p||2&n)&&d!==(d=e[1].payload.type+"")&&Pt(r,d);let o=c;c=g(e),c===o?m[c].p(e,n):(nn(),sn(m[o],1,1,()=>{m[o]=null}),rn(),l=m[c],l||(l=m[c]=y[c](e),l.c()),on(l,1),l.m(t,null)),4&n&&Et(t,"pinned",e[2])},i(e){p||(on(l),p=!0)},o(e){sn(l),p=!1},d(e){e&&mt(t),m[c].d(),nt(f)}}}function wr(e,t,n){let{logIndex:r}=t,{action:o}=t,{pinned:i}=t,{payload:s}=t,{payloadComponent:a}=t;const c=Tt(),l=o.payload.args||[],u=o.payload.playerID;return e.$set=e=>{"logIndex"in e&&n(0,r=e.logIndex),"action"in e&&n(1,o=e.action),"pinned"in e&&n(2,i=e.pinned),"payload"in e&&n(3,s=e.payload),"payloadComponent"in e&&n(4,a=e.payloadComponent)},[r,o,i,s,a,c,l,u,()=>c("click",{logIndex:r}),()=>c("mouseenter",{logIndex:r}),()=>c("mouseleave")]}class xr extends hn{constructor(e){var t;super(),document.getElementById("svelte-10wdo7v-style")||((t=vt("style")).id="svelte-10wdo7v-style",t.textContent=".log-event.svelte-10wdo7v{grid-column:2;cursor:pointer;overflow:hidden;display:flex;flex-direction:column;justify-content:center;background:#fff;border:1px dotted #ccc;border-left:5px solid #ccc;padding:5px;text-align:center;color:#888;font-size:14px;min-height:25px;line-height:25px}.log-event.svelte-10wdo7v:hover{border-style:solid;background:#eee}.log-event.pinned.svelte-10wdo7v{border-style:solid;background:#eee;opacity:1}.player0.svelte-10wdo7v{border-left-color:#ff851b}.player1.svelte-10wdo7v{border-left-color:#7fdbff}.player2.svelte-10wdo7v{border-left-color:#0074d9}.player3.svelte-10wdo7v{border-left-color:#39cccc}.player4.svelte-10wdo7v{border-left-color:#3d9970}.player5.svelte-10wdo7v{border-left-color:#2ecc40}.player6.svelte-10wdo7v{border-left-color:#01ff70}.player7.svelte-10wdo7v{border-left-color:#ffdc00}.player8.svelte-10wdo7v{border-left-color:#001f3f}.player9.svelte-10wdo7v{border-left-color:#ff4136}.player10.svelte-10wdo7v{border-left-color:#85144b}.player11.svelte-10wdo7v{border-left-color:#f012be}.player12.svelte-10wdo7v{border-left-color:#b10dc9}.player13.svelte-10wdo7v{border-left-color:#111111}.player14.svelte-10wdo7v{border-left-color:#aaaaaa}.player15.svelte-10wdo7v{border-left-color:#dddddd}",ht(document.head,t)),dn(this,e,wr,br,ot,{logIndex:0,action:1,pinned:2,payload:3,payloadComponent:4})}}function kr(e){let t,n;return{c(){t=bt("title"),n=wt(e[0])},m(e,r){yt(e,t,r),ht(t,n)},p(e,t){1&t&&Pt(n,e[0])},d(e){e&&mt(t)}}}function Cr(e){let t,n,r,o=e[0]&&kr(e);const i=e[3].default,s=function(e,t,n,r){if(e){const o=at(e,t,n,r);return e[0](o)}}(i,e,e[2],null);return{c(){t=bt("svg"),o&&o.c(),n=kt(),s&&s.c(),$t(t,"xmlns","http://www.w3.org/2000/svg"),$t(t,"viewBox",e[1]),$t(t,"class","svelte-c8tyih")},m(e,i){yt(e,t,i),o&&o.m(t,null),ht(t,n),s&&s.m(t,null),r=!0},p(e,[a]){e[0]?o?o.p(e,a):(o=kr(e),o.c(),o.m(t,n)):o&&(o.d(1),o=null),s&&s.p&&4&a&&s.p(at(i,e,e[2],null),function(e,t,n,r){if(e[2]&&r){const o=e[2](r(n));if(void 0===t.dirty)return o;if("object"==typeof o){const e=[],n=Math.max(t.dirty.length,o.length);for(let r=0;r<n;r+=1)e[r]=t.dirty[r]|o[r];return e}return t.dirty|o}return t.dirty}(i,e[2],a,null)),(!r||2&a)&&$t(t,"viewBox",e[1])},i(e){r||(on(s,e),r=!0)},o(e){sn(s,e),r=!1},d(e){e&&mt(t),o&&o.d(),s&&s.d(e)}}}function $r(e,t,n){let{title:r=null}=t,{viewBox:o}=t,{$$slots:i={},$$scope:s}=t;return e.$set=e=>{"title"in e&&n(0,r=e.title),"viewBox"in e&&n(1,o=e.viewBox),"$$scope"in e&&n(2,s=e.$$scope)},[r,o,s,i]}class Pr extends hn{constructor(e){var t;super(),document.getElementById("svelte-c8tyih-style")||((t=vt("style")).id="svelte-c8tyih-style",t.textContent="svg.svelte-c8tyih{stroke:currentColor;fill:currentColor;stroke-width:0;width:100%;height:auto;max-height:100%}",ht(document.head,t)),dn(this,e,$r,Cr,ot,{title:0,viewBox:1})}}function Or(e){let t;return{c(){t=bt("path"),$t(t,"d","M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z")},m(e,n){yt(e,t,n)},d(e){e&&mt(t)}}}function Ir(e){let t;const n=[{viewBox:"0 0 512 512"},e[0]];let r={$$slots:{default:[Or]},$$scope:{ctx:e}};for(let e=0;e<n.length;e+=1)r=Qe(r,n[e]);const o=new Pr({props:r});return{c(){ln(o.$$.fragment)},m(e,n){un(o,e,n),t=!0},p(e,[t]){const r=1&t?function(e,t){const n={},r={},o={$$scope:1};let i=e.length;for(;i--;){const s=e[i],a=t[i];if(a){for(const e in s)e in a||(r[e]=1);for(const e in a)o[e]||(n[e]=a[e],o[e]=1);e[i]=a}else for(const e in s)o[e]=1}for(const e in r)e in n||(n[e]=void 0);return n}(n,[n[0],(i=e[0],"object"==typeof i&&null!==i?i:{})]):{};var i;2&t&&(r.$$scope={dirty:t,ctx:e}),o.$set(r)},i(e){t||(on(o.$$.fragment,e),t=!0)},o(e){sn(o.$$.fragment,e),t=!1},d(e){pn(o,e)}}}function Er(e,t,n){return e.$set=e=>{n(0,t=Qe(Qe({},t),ct(e)))},[t=ct(t)]}class Dr extends hn{constructor(e){super(),dn(this,e,Er,Ir,ot,{})}}function Ar(e){let t,n;return{c(){t=vt("div"),n=wt(e[0]),$t(t,"alt",e[0]),$t(t,"class","svelte-1a7time")},m(e,r){yt(e,t,r),ht(t,n)},p(e,[r]){1&r&&Pt(n,e[0]),1&r&&$t(t,"alt",e[0])},i:Xe,o:Xe,d(e){e&&mt(t)}}}function Sr(e,t,n){let r,{action:o}=t;return e.$set=e=>{"action"in e&&n(1,o=e.action)},e.$$.update=()=>{if(2&e.$$.dirty){const{type:e,args:t}=o.payload,i=(t||[]).join(",");n(0,r=`${e}(${i})`)}},[r,o]}class _r extends hn{constructor(e){var t;super(),document.getElementById("svelte-1a7time-style")||((t=vt("style")).id="svelte-1a7time-style",t.textContent="div.svelte-1a7time{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;max-width:500px}",ht(document.head,t)),dn(this,e,Sr,Ar,ot,{action:1})}}function jr(e,t,n){const r=e.slice();return r[10]=t[n],r[12]=n,r}function Nr(e){let t,n,r,o,i,s,a,c,l,u,p,f=e[10].value+"",d=e[10].visits+"";const h=new _r({props:{action:e[10].parentAction}});function y(...t){return e[7](e[10],e[12],...t)}function m(...t){return e[8](e[12],...t)}function g(...t){return e[9](e[10],e[12],...t)}return{c(){t=vt("tr"),n=vt("td"),r=wt(f),o=xt(),i=vt("td"),s=wt(d),a=xt(),c=vt("td"),ln(h.$$.fragment),l=xt(),$t(n,"class","svelte-ztcwsu"),$t(i,"class","svelte-ztcwsu"),$t(c,"class","svelte-ztcwsu"),$t(t,"class","svelte-ztcwsu"),Et(t,"clickable",e[1].length>0),Et(t,"selected",e[12]===e[0])},m(e,f,d){yt(e,t,f),ht(t,n),ht(n,r),ht(t,o),ht(t,i),ht(i,s),ht(t,a),ht(t,c),un(h,c,null),ht(t,l),u=!0,d&&nt(p),p=[Ct(t,"click",y),Ct(t,"mouseout",m),Ct(t,"mouseover",g)]},p(n,o){e=n,(!u||2&o)&&f!==(f=e[10].value+"")&&Pt(r,f),(!u||2&o)&&d!==(d=e[10].visits+"")&&Pt(s,d);const i={};2&o&&(i.action=e[10].parentAction),h.$set(i),2&o&&Et(t,"clickable",e[1].length>0),1&o&&Et(t,"selected",e[12]===e[0])},i(e){u||(on(h.$$.fragment,e),u=!0)},o(e){sn(h.$$.fragment,e),u=!1},d(e){e&&mt(t),pn(h),nt(p)}}}function Br(e){let t,n,r,o,i,s=e[1],a=[];for(let t=0;t<s.length;t+=1)a[t]=Nr(jr(e,s,t));const c=e=>sn(a[e],1,1,()=>{a[e]=null});return{c(){t=vt("table"),n=vt("thead"),n.innerHTML='<th class="svelte-ztcwsu">Value</th> \n    <th class="svelte-ztcwsu">Visits</th> \n    <th class="svelte-ztcwsu">Action</th>',r=xt(),o=vt("tbody");for(let e=0;e<a.length;e+=1)a[e].c();$t(t,"class","svelte-ztcwsu")},m(e,s){yt(e,t,s),ht(t,n),ht(t,r),ht(t,o);for(let e=0;e<a.length;e+=1)a[e].m(o,null);i=!0},p(e,[t]){if(15&t){let n;for(s=e[1],n=0;n<s.length;n+=1){const r=jr(e,s,n);a[n]?(a[n].p(r,t),on(a[n],1)):(a[n]=Nr(r),a[n].c(),on(a[n],1),a[n].m(o,null))}for(nn(),n=s.length;n<a.length;n+=1)c(n);rn()}},i(e){if(!i){for(let e=0;e<s.length;e+=1)on(a[e]);i=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)sn(a[e]);i=!1},d(e){e&&mt(t),gt(a,e)}}}function Fr(e,t,n){let{root:r}=t,{selectedIndex:o=null}=t;const i=Tt();let s=[],a=[];function c(e,t){i("select",{node:e,selectedIndex:t})}function l(e,t){null===o&&i("preview",{node:e})}return e.$set=e=>{"root"in e&&n(4,r=e.root),"selectedIndex"in e&&n(0,o=e.selectedIndex)},e.$$.update=()=>{if(48&e.$$.dirty){let e=r;for(n(5,s=[]);e.parent;){const t=e.parent,{type:n,args:r}=e.parentAction.payload,o=`${n}(${(r||[]).join(",")})`;s.push({parent:t,arrowText:o}),e=t}s.reverse(),n(1,a=[...r.children].sort((e,t)=>e.visits<t.visits?1:-1).slice(0,50))}},[o,a,c,l,r,s,i,(e,t)=>c(e,t),e=>l(null),(e,t)=>l(e)]}class Mr extends hn{constructor(e){var t;super(),document.getElementById("svelte-ztcwsu-style")||((t=vt("style")).id="svelte-ztcwsu-style",t.textContent="table.svelte-ztcwsu.svelte-ztcwsu{font-size:12px;border-collapse:collapse;border:1px solid #ddd;padding:0}tr.svelte-ztcwsu.svelte-ztcwsu{cursor:pointer}tr.svelte-ztcwsu:hover td.svelte-ztcwsu{background:#eee}tr.selected.svelte-ztcwsu td.svelte-ztcwsu{background:#eee}td.svelte-ztcwsu.svelte-ztcwsu{padding:10px;height:10px;line-height:10px;font-size:12px;border:none}th.svelte-ztcwsu.svelte-ztcwsu{background:#888;color:#fff;padding:10px;text-align:center}",ht(document.head,t)),dn(this,e,Fr,Br,ot,{root:4,selectedIndex:0})}}function Tr(e,t,n){const r=e.slice();return r[9]=t[n].node,r[10]=t[n].selectedIndex,r[12]=n,r}function Rr(e){let t;const n=new Mr({props:{root:e[9],selectedIndex:e[10]}});return n.$on("select",(function(...t){return e[8](e[12],...t)})),{c(){ln(n.$$.fragment)},m(e,r){un(n,e,r),t=!0},p(t,r){e=t;const o={};1&r&&(o.root=e[9]),1&r&&(o.selectedIndex=e[10]),n.$set(o)},i(e){t||(on(n.$$.fragment,e),t=!0)},o(e){sn(n.$$.fragment,e),t=!1},d(e){pn(n,e)}}}function qr(e){let t;const n=new Mr({props:{root:e[9]}});return n.$on("select",(function(...t){return e[6](e[12],...t)})),n.$on("preview",(function(...t){return e[7](e[12],...t)})),{c(){ln(n.$$.fragment)},m(e,r){un(n,e,r),t=!0},p(t,r){e=t;const o={};1&r&&(o.root=e[9]),n.$set(o)},i(e){t||(on(n.$$.fragment,e),t=!0)},o(e){sn(n.$$.fragment,e),t=!1},d(e){pn(n,e)}}}function zr(e){let t,n,r,o,i,s=0!==e[12]&&function(e){let t,n;const r=new Dr({});return{c(){t=vt("div"),ln(r.$$.fragment),$t(t,"class","icon svelte-1f0amz4")},m(e,o){yt(e,t,o),un(r,t,null),n=!0},i(e){n||(on(r.$$.fragment,e),n=!0)},o(e){sn(r.$$.fragment,e),n=!1},d(e){e&&mt(t),pn(r)}}}();const a=[qr,Rr],c=[];function l(e,t){return e[12]===e[0].length-1?0:1}return r=l(e),o=c[r]=a[r](e),{c(){s&&s.c(),t=xt(),n=vt("section"),o.c()},m(e,o){s&&s.m(e,o),yt(e,t,o),yt(e,n,o),c[r].m(n,null),i=!0},p(e,t){let i=r;r=l(e),r===i?c[r].p(e,t):(nn(),sn(c[i],1,1,()=>{c[i]=null}),rn(),o=c[r],o||(o=c[r]=a[r](e),o.c()),on(o,1),o.m(n,null))},i(e){i||(on(s),on(o),i=!0)},o(e){sn(s),sn(o),i=!1},d(e){s&&s.d(e),e&&mt(t),e&&mt(n),c[r].d()}}}function Lr(e){let t,n,r,o;const i=new Dr({}),s=new Mr({props:{root:e[1]}});return{c(){t=vt("div"),ln(i.$$.fragment),n=xt(),r=vt("section"),ln(s.$$.fragment),$t(t,"class","icon svelte-1f0amz4"),$t(r,"class","preview svelte-1f0amz4")},m(e,a){yt(e,t,a),un(i,t,null),yt(e,n,a),yt(e,r,a),un(s,r,null),o=!0},p(e,t){const n={};2&t&&(n.root=e[1]),s.$set(n)},i(e){o||(on(i.$$.fragment,e),on(s.$$.fragment,e),o=!0)},o(e){sn(i.$$.fragment,e),sn(s.$$.fragment,e),o=!1},d(e){e&&mt(t),pn(i),e&&mt(n),e&&mt(r),pn(s)}}}function Ur(e){let t,n,r,o=e[0],i=[];for(let t=0;t<o.length;t+=1)i[t]=zr(Tr(e,o,t));const s=e=>sn(i[e],1,1,()=>{i[e]=null});let a=e[1]&&Lr(e);return{c(){t=vt("div");for(let e=0;e<i.length;e+=1)i[e].c();n=xt(),a&&a.c(),$t(t,"class","visualizer svelte-1f0amz4")},m(e,o){yt(e,t,o);for(let e=0;e<i.length;e+=1)i[e].m(t,null);ht(t,n),a&&a.m(t,null),r=!0},p(e,[r]){if(13&r){let a;for(o=e[0],a=0;a<o.length;a+=1){const s=Tr(e,o,a);i[a]?(i[a].p(s,r),on(i[a],1)):(i[a]=zr(s),i[a].c(),on(i[a],1),i[a].m(t,n))}for(nn(),a=o.length;a<i.length;a+=1)s(a);rn()}e[1]?a?(a.p(e,r),on(a,1)):(a=Lr(e),a.c(),on(a,1),a.m(t,null)):a&&(nn(),sn(a,1,1,()=>{a=null}),rn())},i(e){if(!r){for(let e=0;e<o.length;e+=1)on(i[e]);on(a),r=!0}},o(e){i=i.filter(Boolean);for(let e=0;e<i.length;e+=1)sn(i[e]);sn(a),r=!1},d(e){e&&mt(t),gt(i,e),a&&a.d()}}}function Gr(e,t,n){let{metadata:r}=t,o=[],i=[],s=null;function a({node:e,selectedIndex:t},r){n(1,s=null),n(0,o[r].selectedIndex=t,o),n(0,o=[...o.slice(0,r+1),{node:e}])}function c({node:e},t){n(1,s=e)}return e.$set=e=>{"metadata"in e&&n(4,r=e.metadata)},e.$$.update=()=>{16&e.$$.dirty&&(i=[],n(0,o=[{node:r}]))},[o,s,a,c,r,i,(e,t)=>a(t.detail,e),(e,t)=>c(t.detail),(e,t)=>a(t.detail,e)]}class Hr extends hn{constructor(e){var t;super(),document.getElementById("svelte-1f0amz4-style")||((t=vt("style")).id="svelte-1f0amz4-style",t.textContent=".visualizer.svelte-1f0amz4{display:flex;flex-direction:column;align-items:center;padding:50px}.preview.svelte-1f0amz4{opacity:0.5}.icon.svelte-1f0amz4{color:#777;width:32px;height:32px;margin-bottom:20px}",ht(document.head,t)),dn(this,e,Gr,Ur,ot,{metadata:4})}}function Vr(e,t,n){const r=e.slice();return r[15]=t[n].phase,r[17]=n,r}function Jr(e,t,n){const r=e.slice();return r[18]=t[n].action,r[19]=t[n].payload,r[17]=n,r}function Kr(e,t,n){const r=e.slice();return r[21]=t[n].turn,r[17]=n,r}function Wr(e){let t;const n=new ur({props:{turn:e[21],numEvents:e[3][e[17]]}});return{c(){ln(n.$$.fragment)},m(e,r){un(n,e,r),t=!0},p(e,t){const r={};4&t&&(r.turn=e[21]),8&t&&(r.numEvents=e[3][e[17]]),n.$set(r)},i(e){t||(on(n.$$.fragment,e),t=!0)},o(e){sn(n.$$.fragment,e),t=!1},d(e){pn(n,e)}}}function Yr(e){let t,n,r=e[17]in e[3]&&Wr(e);return{c(){r&&r.c(),t=kt()},m(e,o){r&&r.m(e,o),yt(e,t,o),n=!0},p(e,n){e[17]in e[3]?r?(r.p(e,n),on(r,1)):(r=Wr(e),r.c(),on(r,1),r.m(t.parentNode,t)):r&&(nn(),sn(r,1,1,()=>{r=null}),rn())},i(e){n||(on(r),n=!0)},o(e){sn(r),n=!1},d(e){r&&r.d(e),e&&mt(t)}}}function Xr(e){let t;const n=new xr({props:{pinned:e[17]===e[1],logIndex:e[17],action:e[18],payload:e[19]}});return n.$on("click",e[5]),n.$on("mouseenter",e[6]),n.$on("mouseleave",e[7]),{c(){ln(n.$$.fragment)},m(e,r){un(n,e,r),t=!0},p(e,t){const r={};2&t&&(r.pinned=e[17]===e[1]),4&t&&(r.action=e[18]),4&t&&(r.payload=e[19]),n.$set(r)},i(e){t||(on(n.$$.fragment,e),t=!0)},o(e){sn(n.$$.fragment,e),t=!1},d(e){pn(n,e)}}}function Zr(e){let t;const n=new dr({props:{phase:e[15],numEvents:e[4][e[17]]}});return{c(){ln(n.$$.fragment)},m(e,r){un(n,e,r),t=!0},p(e,t){const r={};4&t&&(r.phase=e[15]),16&t&&(r.numEvents=e[4][e[17]]),n.$set(r)},i(e){t||(on(n.$$.fragment,e),t=!0)},o(e){sn(n.$$.fragment,e),t=!1},d(e){pn(n,e)}}}function Qr(e){let t,n,r=e[17]in e[4]&&Zr(e);return{c(){r&&r.c(),t=kt()},m(e,o){r&&r.m(e,o),yt(e,t,o),n=!0},p(e,n){e[17]in e[4]?r?(r.p(e,n),on(r,1)):(r=Zr(e),r.c(),on(r,1),r.m(t.parentNode,t)):r&&(nn(),sn(r,1,1,()=>{r=null}),rn())},i(e){n||(on(r),n=!0)},o(e){sn(r),n=!1},d(e){r&&r.d(e),e&&mt(t)}}}function eo(e){let t,n,r,o,i,s=e[2],a=[];for(let t=0;t<s.length;t+=1)a[t]=Yr(Kr(e,s,t));const c=e=>sn(a[e],1,1,()=>{a[e]=null});let l=e[2],u=[];for(let t=0;t<l.length;t+=1)u[t]=Xr(Jr(e,l,t));const p=e=>sn(u[e],1,1,()=>{u[e]=null});let f=e[2],d=[];for(let t=0;t<f.length;t+=1)d[t]=Qr(Vr(e,f,t));const h=e=>sn(d[e],1,1,()=>{d[e]=null});return{c(){t=vt("div");for(let e=0;e<a.length;e+=1)a[e].c();n=xt();for(let e=0;e<u.length;e+=1)u[e].c();r=xt();for(let e=0;e<d.length;e+=1)d[e].c();$t(t,"class","gamelog svelte-1pq5e4b"),Et(t,"pinned",e[1])},m(s,c,l){yt(s,t,c);for(let e=0;e<a.length;e+=1)a[e].m(t,null);ht(t,n);for(let e=0;e<u.length;e+=1)u[e].m(t,null);ht(t,r);for(let e=0;e<d.length;e+=1)d[e].m(t,null);o=!0,l&&i(),i=Ct(window,"keydown",e[8])},p(e,[o]){if(12&o){let r;for(s=e[2],r=0;r<s.length;r+=1){const i=Kr(e,s,r);a[r]?(a[r].p(i,o),on(a[r],1)):(a[r]=Yr(i),a[r].c(),on(a[r],1),a[r].m(t,n))}for(nn(),r=s.length;r<a.length;r+=1)c(r);rn()}if(230&o){let n;for(l=e[2],n=0;n<l.length;n+=1){const i=Jr(e,l,n);u[n]?(u[n].p(i,o),on(u[n],1)):(u[n]=Xr(i),u[n].c(),on(u[n],1),u[n].m(t,r))}for(nn(),n=l.length;n<u.length;n+=1)p(n);rn()}if(20&o){let n;for(f=e[2],n=0;n<f.length;n+=1){const r=Vr(e,f,n);d[n]?(d[n].p(r,o),on(d[n],1)):(d[n]=Qr(r),d[n].c(),on(d[n],1),d[n].m(t,null))}for(nn(),n=f.length;n<d.length;n+=1)h(n);rn()}2&o&&Et(t,"pinned",e[1])},i(e){if(!o){for(let e=0;e<s.length;e+=1)on(a[e]);for(let e=0;e<l.length;e+=1)on(u[e]);for(let e=0;e<f.length;e+=1)on(d[e]);o=!0}},o(e){a=a.filter(Boolean);for(let e=0;e<a.length;e+=1)sn(a[e]);u=u.filter(Boolean);for(let e=0;e<u.length;e+=1)sn(u[e]);d=d.filter(Boolean);for(let e=0;e<d.length;e+=1)sn(d[e]);o=!1},d(e){e&&mt(t),gt(a,e),gt(u,e),gt(d,e),i()}}}function to(e,t,n){let r,o=Xe,i=()=>(o(),o=it(s,e=>n(10,r=e)),s);e.$$.on_destroy.push(()=>o());let{client:s}=t;i();const{secondaryPane:a}=qt("secondaryPane"),c=s.getInitialState();let l,{log:u}=r,p=null;function f(e){let t=c;for(let n=0;n<u.length;n++){const{action:r,automatic:o}=u[n];if(o||(t=s.reducer(t,r)),"MAKE_MOVE"==r.type){if(0==e)break;e--}}return{G:t.G,ctx:t.ctx}}function d(){n(1,p=null),s.overrideGameState(null),a.set(null)}Mt(d);let h={},y={};return e.$set=e=>{"client"in e&&i(n(0,s=e.client))},e.$$.update=()=>{if(1540&e.$$.dirty){n(9,u=r.log),n(2,l=u.filter(e=>"MAKE_MOVE"==e.action.type));let e=0,t=0;n(3,h={}),n(4,y={});for(let r=0;r<l.length;r++){const{action:o,payload:i,turn:s,phase:a}=l[r];t++,e++,r!=l.length-1&&l[r+1].turn==s||(n(3,h[r]=t,h),t=0),r!=l.length-1&&l[r+1].phase==a||(n(4,y[r]=e,y),e=0)}}},[s,p,l,h,y,function(e){const{logIndex:t}=e.detail,r=f(t),o=u.filter(e=>"MAKE_MOVE"==e.action.type);if(s.overrideGameState(r),p==t)n(1,p=null),a.set(null);else{n(1,p=t);const{metadata:e}=o[t].action.payload;e&&a.set({component:Hr,metadata:e})}},function(e){const{logIndex:t}=e.detail;if(null===p){const e=f(t);s.overrideGameState(e)}},function(){null===p&&s.overrideGameState(null)},function(e){27==e.keyCode&&d()}]}class no extends hn{constructor(e){var t;super(),document.getElementById("svelte-1pq5e4b-style")||((t=vt("style")).id="svelte-1pq5e4b-style",t.textContent=".gamelog.svelte-1pq5e4b{display:grid;grid-template-columns:30px 1fr 30px;grid-auto-rows:auto;grid-auto-flow:column}",ht(document.head,t)),dn(this,e,to,eo,ot,{client:0})}}function ro(e,t,n){const r=e.slice();return r[5]=t[n][0],r[6]=t[n][1],r}function oo(e){let t,n,r,o,i,s,a,c=e[1][e[5]]+"";function l(){e[3].call(o,e[5])}return{c(){t=vt("span"),n=wt(c),r=xt(),o=vt("input"),$t(t,"class","value svelte-7cel4i"),$t(o,"type","range"),$t(o,"min",i=e[6].range.min),$t(o,"max",s=e[6].range.max)},m(i,s,c){yt(i,t,s),ht(t,n),yt(i,r,s),yt(i,o,s),Ot(o,e[1][e[5]]),c&&nt(a),a=[Ct(o,"change",l),Ct(o,"input",l),Ct(o,"change",e[2])]},p(t,r){e=t,3&r&&c!==(c=e[1][e[5]]+"")&&Pt(n,c),1&r&&i!==(i=e[6].range.min)&&$t(o,"min",i),1&r&&s!==(s=e[6].range.max)&&$t(o,"max",s),3&r&&Ot(o,e[1][e[5]])},d(e){e&&mt(t),e&&mt(r),e&&mt(o),nt(a)}}}function io(e){let t,n;function r(){e[4].call(t,e[5])}return{c(){t=vt("input"),$t(t,"type","checkbox"),$t(t,"class","svelte-7cel4i")},m(o,i,s){yt(o,t,i),t.checked=e[1][e[5]],s&&nt(n),n=[Ct(t,"change",r),Ct(t,"change",e[2])]},p(n,r){e=n,3&r&&(t.checked=e[1][e[5]])},d(e){e&&mt(t),nt(n)}}}function so(e){let t,n,r,o,i,s,a=e[5]+"",c=e[6].range&&oo(e),l="boolean"==typeof e[6].value&&io(e);return{c(){t=vt("div"),n=vt("label"),r=wt(a),o=xt(),c&&c.c(),i=xt(),l&&l.c(),s=xt(),$t(n,"class","svelte-7cel4i"),$t(t,"class","option svelte-7cel4i")},m(e,a){yt(e,t,a),ht(t,n),ht(n,r),ht(t,o),c&&c.m(t,null),ht(t,i),l&&l.m(t,null),ht(t,s)},p(e,n){1&n&&a!==(a=e[5]+"")&&Pt(r,a),e[6].range?c?c.p(e,n):(c=oo(e),c.c(),c.m(t,i)):c&&(c.d(1),c=null),"boolean"==typeof e[6].value?l?l.p(e,n):(l=io(e),l.c(),l.m(t,s)):l&&(l.d(1),l=null)},d(e){e&&mt(t),c&&c.d(),l&&l.d()}}}function ao(e){let t,n=Object.entries(e[0].opts()),r=[];for(let t=0;t<n.length;t+=1)r[t]=so(ro(e,n,t));return{c(){for(let e=0;e<r.length;e+=1)r[e].c();t=kt()},m(e,n){for(let t=0;t<r.length;t+=1)r[t].m(e,n);yt(e,t,n)},p(e,[o]){if(7&o){let i;for(n=Object.entries(e[0].opts()),i=0;i<n.length;i+=1){const s=ro(e,n,i);r[i]?r[i].p(s,o):(r[i]=so(s),r[i].c(),r[i].m(t.parentNode,t))}for(;i<r.length;i+=1)r[i].d(1);r.length=n.length}},i:Xe,o:Xe,d(e){gt(r,e),e&&mt(t)}}}function co(e,t,n){let{bot:r}=t,o={};for(let[e,t]of Object.entries(r.opts()))o[e]=t.value;return e.$set=e=>{"bot"in e&&n(0,r=e.bot)},[r,o,function(){for(let[e,t]of Object.entries(o))r.setOpt(e,t)},function(e){o[e]=function(e){return""===e?void 0:+e}(this.value),n(1,o),n(0,r)},function(e){o[e]=this.checked,n(1,o),n(0,r)}]}class lo extends hn{constructor(e){var t;super(),document.getElementById("svelte-7cel4i-style")||((t=vt("style")).id="svelte-7cel4i-style",t.textContent="label.svelte-7cel4i{font-weight:bold;color:#999}.option.svelte-7cel4i{margin-bottom:20px}.value.svelte-7cel4i{font-weight:bold}input[type='checkbox'].svelte-7cel4i{vertical-align:middle}",ht(document.head,t)),dn(this,e,co,ao,ot,{bot:0})}}function uo({game:e,isClient:t}){return e=Ye(e),(n=null,r)=>{switch(r.type){case"GAME_EVENT":{if(n={...n,deltalog:[]},t)return n;if(void 0!==n.ctx.gameover)return Le("cannot call event after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return Le("disallowed event: "+r.payload.type),n;n=Te(n,{game:e,isClient:!1,playerID:r.payload.playerID});let o=e.flow.processEvent(n,r);return o=Re(o,{game:e,isClient:!1}),{...o,_stateID:n._stateID+1}}case"MAKE_MOVE":{n={...n,deltalog:[]};const o=e.flow.getMove(n.ctx,r.payload.type,r.payload.playerID||n.ctx.currentPlayer);if(null===o)return Le("disallowed move: "+r.payload.type),n;if(t&&!1===o.client)return n;if(void 0!==n.ctx.gameover)return Le("cannot make move after game end"),n;if(null!==r.payload.playerID&&void 0!==r.payload.playerID&&!e.flow.isPlayerActive(n.G,n.ctx,r.payload.playerID))return Le("disallowed move: "+r.payload.type),n;n=Te(n,{game:e,isClient:t,playerID:r.payload.playerID});let i=e.processMove(n,r.payload);if("INVALID_MOVE"===i)return Le(`invalid move: ${r.payload.type} args: ${r.payload.args}`),n;let s={action:r,_stateID:n._stateID,turn:n.ctx.turn,phase:n.ctx.phase};!0===o.redact&&(s.redact=!0);const a={...n,G:i,deltalog:[s],_stateID:n._stateID+1};return t&&((e,t)=>[...Be,...t.game.plugins].filter(e=>void 0!==e.noClient).map(n=>{const r=n.name,o=e.plugins[r];return!!o&&n.noClient({G:e.G,ctx:e.ctx,game:t.game,api:o.api,data:o.data})}).some(e=>!0===e))(a,{game:e})?n:(n=a,t?n=Re(n,{game:e,isClient:!0}):(n=e.flow.processMove(n,r.payload),n=Re(n,{game:e})))}case"RESET":case"UPDATE":case"SYNC":return r.state;case"UNDO":{const{_undo:t,_redo:r}=n;if(t.length<2)return n;const a=t[t.length-1],c=t[t.length-2],l=e.flow.getMove(n.ctx,a.moveType,n.ctx.currentPlayer);return o=n.G,i=n.ctx,function(e){return void 0!==e.undoable}(s=l)&&!(s.undoable instanceof Function?s.undoable(o,i):s.undoable)?n:{...n,G:c.G,ctx:c.ctx,_undo:t.slice(0,t.length-1),_redo:[a,...r]}}case"REDO":{const{_undo:e,_redo:t}=n;if(0==t.length)return n;const r=t[0];return{...n,G:r.G,ctx:r.ctx,_undo:[...e,r],_redo:t.slice(1)}}case"PLUGIN":return((e,t,n)=>(n.game.plugins.filter(e=>void 0!==e.action).filter(e=>e.name===t.payload.type).forEach(n=>{const r=n.name,o=e.plugins[r]||{data:{}},i=n.action(o.data,t.payload);e={...e,plugins:{...e.plugins,[r]:{...o,data:i}}}}),e))(n,r,{game:e});default:return n}var o,i,s}}var po=function(){function e(t){var n=this,o=t.enumerate,i=t.seed;r(this,e),s(this,"enumerate",(function(e,t,r){return n.enumerateFn(e,t,r).map((function(e){return void 0!==e.payload?e:void 0!==e.move?A(e.move,e.args,r):void 0!==e.event?S(e.event,e.args,r):void 0}))})),this.enumerateFn=o,this.seed=i,this.iterationCounter=0,this._opts={}}return i(e,[{key:"addOpt",value:function(e){var t=e.key,n=e.range,r=e.initial;this._opts[t]={range:n,value:r}}},{key:"getOpt",value:function(e){return this._opts[e].value}},{key:"setOpt",value:function(e,t){e in this._opts&&(this._opts[e].value=t)}},{key:"opts",value:function(){return this._opts}},{key:"random",value:function(e){var t;if(void 0!==this.seed){var n=null;t=(n=this.prngstate?new Se("",{state:this.prngstate}):new Se(this.seed,{state:!0}))(),this.prngstate=n.state()}else t=Math.random();return e?e.length?e[Math.floor(t*e.length)]:Math.floor(t*e):t}}]),e}(),fo=function(e){l(o,e);var t=y(o);function o(e){var n,i=e.enumerate,s=e.seed,a=e.objectives,c=e.game,l=e.iterations,u=e.playoutDepth,p=e.iterationCallback;return r(this,o),void 0===a&&(a=function(){return{}}),(n=t.call(this,{enumerate:i,seed:s})).objectives=a,n.iterationCallback=p||function(){},n.reducer=uo({game:c}),n.iterations=l,n.playoutDepth=u,n.addOpt({key:"async",initial:!1}),n.addOpt({key:"iterations",initial:"number"==typeof l?l:1e3,range:{min:1,max:2e3}}),n.addOpt({key:"playoutDepth",initial:"number"==typeof u?u:50,range:{min:1,max:100}}),n}return i(o,[{key:"createNode",value:function(e){var t=e.state,n=e.parentAction,r=e.parent,o=e.playerID,i=t.G,s=t.ctx,a=[],c=[];if(void 0!==o)a=this.enumerate(i,s,o),c=this.objectives(i,s,o);else if(s.activePlayers)for(var l in s.activePlayers)a=a.concat(this.enumerate(i,s,l)),c=c.concat(this.objectives(i,s,l));else a=a.concat(this.enumerate(i,s,s.currentPlayer)),c=c.concat(this.objectives(i,s,s.currentPlayer));return{state:t,parent:r,parentAction:n,actions:a,objectives:c,children:[],visits:0,value:0}}},{key:"select",value:function(e){if(e.actions.length>0)return e;if(0==e.children.length)return e;var t,n=null,r=0,o=b(e.children);try{for(o.s();!(t=o.n()).done;){var i=t.value,s=i.visits+Number.EPSILON,a=i.value/s+Math.sqrt(2*Math.log(e.visits)/s);(null==n||a>r)&&(r=a,n=i)}}catch(e){o.e(e)}finally{o.f()}return this.select(n)}},{key:"expand",value:function(e){var t=e.actions;if(0==t.length||void 0!==e.state.ctx.gameover)return e;var n=this.random(t.length),r=t[n];e.actions.splice(n,1);var o=this.reducer(e.state,r),i=this.createNode({state:o,parentAction:r,parent:e});return e.children.push(i),i}},{key:"playout",value:function(e){var t=this,r=e.state,o=this.getOpt("playoutDepth");"function"==typeof this.playoutDepth&&(o=this.playoutDepth(r.G,r.ctx));for(var i=function(e){var n=r,o=n.G,i=n.ctx,s=i.currentPlayer;i.activePlayers&&(s=Object.keys(i.activePlayers)[0]);var a=t.enumerate(o,i,s),c=t.objectives(o,i),l=Object.keys(c).reduce((function(e,t){var n=c[t];return n.checker(o,i)?e+n.weight:e}),0);if(l>0)return{v:{score:l}};if(!a||0==a.length)return{v:void 0};var u=t.random(a.length),p=t.reducer(r,a[u]);r=p},s=0;s<o&&void 0===r.ctx.gameover;s++){var a=i();if("object"===n(a))return a.v}return r.ctx.gameover}},{key:"backpropagate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.visits++,void 0!==t.score&&(e.value+=t.score),!0===t.draw&&(e.value+=.5),e.parentAction&&t.winner===e.parentAction.payload.playerID&&e.value++,e.parent&&this.backpropagate(e.parent,t)}},{key:"play",value:function(e,t){var n=this,r=this.createNode({state:e,playerID:t}),o=this.getOpt("iterations");"function"==typeof this.iterations&&(o=this.iterations(e.G,e.ctx));var i=function(){var e,t=null,n=b(r.children);try{for(n.s();!(e=n.n()).done;){var o=e.value;(null==t||o.visits>t.visits)&&(t=o)}}catch(e){n.e(e)}finally{n.f()}return{action:t&&t.parentAction,metadata:r}};return new Promise((function(e){var t=function(){for(var e=0;e<25&&n.iterationCounter<o;e++){var t=n.select(r),i=n.expand(t),s=n.playout(i);n.backpropagate(i,s),n.iterationCounter++}n.iterationCallback({iterationCounter:n.iterationCounter,numIterations:o,metadata:r})};if(n.iterationCounter=0,n.getOpt("async")){!function r(){n.iterationCounter<o?(t(),setTimeout(r,0)):e(i())}()}else{for(;n.iterationCounter<o;)t();e(i())}}))}}]),o}(po),ho=function(e){l(n,e);var t=y(n);function n(){return r(this,n),t.apply(this,arguments)}return i(n,[{key:"play",value:function(e,t){var n=e.G,r=e.ctx,o=this.enumerate(n,r,t);return Promise.resolve({action:this.random(o)})}}]),n}(po);async function yo(e,t){var n=e.store.getState(),r=n.ctx.currentPlayer;n.ctx.activePlayers&&(r=Object.keys(n.ctx.activePlayers)[0]);var o=await t.play(n,r),i=o.action,s=o.metadata;return i&&(i.payload.metadata=s,e.store.dispatch(i)),i}function mo(e,t,n){const r=e.slice();return r[7]=t[n],r}function go(e){let t,n,r;return{c(){t=vt("p"),t.textContent="No bots available.",n=xt(),r=vt("p"),r.innerHTML='\n        Follow the instructions\n        <a href="https://boardgame.io/documentation/#/tutorial?id=bots" target="_blank">\n          here</a>\n        to set up bots.\n      '},m(e,o){yt(e,t,o),yt(e,n,o),yt(e,r,o)},p:Xe,i:Xe,o:Xe,d(e){e&&mt(t),e&&mt(n),e&&mt(r)}}}function vo(e){let t;return{c(){t=vt("p"),t.textContent="The bot debugger is only available in singleplayer mode."},m(e,n){yt(e,t,n)},p:Xe,i:Xe,o:Xe,d(e){e&&mt(t)}}}function bo(e){let t,n,r,o,i,s,a,c,l,u,p,f,d,h,y,m,g,v,b=Object.keys(e[7].opts()).length;const w=new In({props:{value:"1",onPress:e[13],label:"reset"}}),x=new In({props:{value:"2",onPress:e[11],label:"play"}}),k=new In({props:{value:"3",onPress:e[12],label:"simulate"}});let C=Object.keys(e[8]),$=[];for(let t=0;t<C.length;t+=1)$[t]=wo(mo(e,C,t));let P=b&&xo(e),O=(e[5]||e[3])&&ko(e);return{c(){t=vt("section"),n=vt("h3"),n.textContent="Controls",r=xt(),o=vt("li"),ln(w.$$.fragment),i=xt(),s=vt("li"),ln(x.$$.fragment),a=xt(),c=vt("li"),ln(k.$$.fragment),l=xt(),u=vt("section"),p=vt("h3"),p.textContent="Bot",f=xt(),d=vt("select");for(let e=0;e<$.length;e+=1)$[e].c();h=xt(),P&&P.c(),y=xt(),O&&O.c(),m=kt(),$t(n,"class","svelte-hsd9fq"),$t(o,"class","svelte-hsd9fq"),$t(s,"class","svelte-hsd9fq"),$t(c,"class","svelte-hsd9fq"),$t(p,"class","svelte-hsd9fq"),void 0===e[4]&&Jt(()=>e[19].call(d))},m(b,C,I){yt(b,t,C),ht(t,n),ht(t,r),ht(t,o),un(w,o,null),ht(t,i),ht(t,s),un(x,s,null),ht(t,a),ht(t,c),un(k,c,null),yt(b,l,C),yt(b,u,C),ht(u,p),ht(u,f),ht(u,d);for(let e=0;e<$.length;e+=1)$[e].m(d,null);It(d,e[4]),yt(b,h,C),P&&P.m(b,C),yt(b,y,C),O&&O.m(b,C),yt(b,m,C),g=!0,I&&nt(v),v=[Ct(d,"change",e[19]),Ct(d,"change",e[10])]},p(e,t){if(256&t){let n;for(C=Object.keys(e[8]),n=0;n<C.length;n+=1){const r=mo(e,C,n);$[n]?$[n].p(r,t):($[n]=wo(r),$[n].c(),$[n].m(d,null))}for(;n<$.length;n+=1)$[n].d(1);$.length=C.length}16&t&&It(d,e[4]),128&t&&(b=Object.keys(e[7].opts()).length),b?P?(P.p(e,t),on(P,1)):(P=xo(e),P.c(),on(P,1),P.m(y.parentNode,y)):P&&(nn(),sn(P,1,1,()=>{P=null}),rn()),e[5]||e[3]?O?O.p(e,t):(O=ko(e),O.c(),O.m(m.parentNode,m)):O&&(O.d(1),O=null)},i(e){g||(on(w.$$.fragment,e),on(x.$$.fragment,e),on(k.$$.fragment,e),on(P),g=!0)},o(e){sn(w.$$.fragment,e),sn(x.$$.fragment,e),sn(k.$$.fragment,e),sn(P),g=!1},d(e){e&&mt(t),pn(w),pn(x),pn(k),e&&mt(l),e&&mt(u),gt($,e),e&&mt(h),P&&P.d(e),e&&mt(y),O&&O.d(e),e&&mt(m),nt(v)}}}function wo(e){let t,n,r,o=e[7]+"";return{c(){t=vt("option"),n=wt(o),t.__value=r=e[7],t.value=t.__value},m(e,r){yt(e,t,r),ht(t,n)},p:Xe,d(e){e&&mt(t)}}}function xo(e){let t,n,r,o,i,s,a,c,l;const u=new lo({props:{bot:e[7]}});return{c(){t=vt("section"),n=vt("h3"),n.textContent="Options",r=xt(),o=vt("label"),o.textContent="debug",i=xt(),s=vt("input"),a=xt(),ln(u.$$.fragment),$t(n,"class","svelte-hsd9fq"),$t(o,"class","svelte-hsd9fq"),$t(s,"type","checkbox"),$t(s,"class","svelte-hsd9fq")},m(p,f,d){yt(p,t,f),ht(t,n),ht(t,r),ht(t,o),ht(t,i),ht(t,s),s.checked=e[1],ht(t,a),un(u,t,null),c=!0,d&&nt(l),l=[Ct(s,"change",e[20]),Ct(s,"change",e[9])]},p(e,t){2&t&&(s.checked=e[1]);const n={};128&t&&(n.bot=e[7]),u.$set(n)},i(e){c||(on(u.$$.fragment,e),c=!0)},o(e){sn(u.$$.fragment,e),c=!1},d(e){e&&mt(t),pn(u),nt(l)}}}function ko(e){let t,n,r,o,i=e[2]&&e[2]<1&&Co(e),s=e[5]&&$o(e);return{c(){t=vt("section"),n=vt("h3"),n.textContent="Result",r=xt(),i&&i.c(),o=xt(),s&&s.c(),$t(n,"class","svelte-hsd9fq")},m(e,a){yt(e,t,a),ht(t,n),ht(t,r),i&&i.m(t,null),ht(t,o),s&&s.m(t,null)},p(e,n){e[2]&&e[2]<1?i?i.p(e,n):(i=Co(e),i.c(),i.m(t,o)):i&&(i.d(1),i=null),e[5]?s?s.p(e,n):(s=$o(e),s.c(),s.m(t,null)):s&&(s.d(1),s=null)},d(e){e&&mt(t),i&&i.d(),s&&s.d()}}}function Co(e){let t;return{c(){t=vt("progress"),t.value=e[2]},m(e,n){yt(e,t,n)},p(e,n){4&n&&(t.value=e[2])},d(e){e&&mt(t)}}}function $o(e){let t,n,r,o,i,s,a,c=JSON.stringify(e[6])+"";return{c(){t=vt("li"),n=wt("Action: "),r=wt(e[5]),o=xt(),i=vt("li"),s=wt("Args: "),a=wt(c),$t(t,"class","svelte-hsd9fq"),$t(i,"class","svelte-hsd9fq")},m(e,c){yt(e,t,c),ht(t,n),ht(t,r),yt(e,o,c),yt(e,i,c),ht(i,s),ht(i,a)},p(e,t){32&t&&Pt(r,e[5]),64&t&&c!==(c=JSON.stringify(e[6])+"")&&Pt(a,c)},d(e){e&&mt(t),e&&mt(o),e&&mt(i)}}}function Po(e){let t,n,r,o,i;const s=[bo,vo,go],a=[];function c(e,t){return e[0].game.ai&&!e[0].multiplayer?0:e[0].multiplayer?1:2}return n=c(e),r=a[n]=s[n](e),{c(){t=vt("section"),r.c()},m(r,s,c){yt(r,t,s),a[n].m(t,null),o=!0,c&&i(),i=Ct(window,"keydown",e[14])},p(e,[o]){let i=n;n=c(e),n===i?a[n].p(e,o):(nn(),sn(a[i],1,1,()=>{a[i]=null}),rn(),r=a[n],r||(r=a[n]=s[n](e),r.c()),on(r,1),r.m(t,null))},i(e){o||(on(r),o=!0)},o(e){sn(r),o=!1},d(e){e&&mt(t),a[n].d(),i()}}}function Oo(e,t,n){let{client:r}=t;const{secondaryPane:o}=qt("secondaryPane"),i={MCTS:fo,Random:ho};let s=!1,a=null,c=0,l=null;const u=({iterationCounter:e,numIterations:t,metadata:r})=>{n(3,c=e),n(2,a=e/t),l=r,s&&l&&o.set({component:Hr,metadata:l})};let p,f,d,h;function y(){r.overrideGameState(null),o.set(null),n(1,s=!1)}return r.game.ai&&(p=new fo({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u}),p.setOpt("async",!0)),Mt(y),e.$set=e=>{"client"in e&&n(0,r=e.client)},[r,s,a,c,f,d,h,p,i,function(){s&&l?o.set({component:Hr,metadata:l}):o.set(null)},function(){n(7,p=new(0,i[f])({game:r.game,enumerate:r.game.ai.enumerate,iterationCallback:u})),p.setOpt("async",!0),n(5,d=null),l=null,o.set(null),n(3,c=0)},async function(){n(5,d=null),l=null,n(3,c=0);const e=await yo(r,p);e&&(n(5,d=e.payload.type),n(6,h=e.payload.args))},function(e=1e4,t=100){return n(5,d=null),l=null,n(3,c=0),(async()=>{for(let n=0;n<e;n++){if(!await yo(r,p))break;await new Promise(e=>setTimeout(e,t))}})()},function(){r.reset(),n(5,d=null),l=null,n(3,c=0),y()},function(e){27==e.keyCode&&y()},l,o,u,y,function(){f=function(e){const t=e.querySelector(":checked")||e.options[0];return t&&t.__value}(this),n(4,f),n(8,i)},function(){s=this.checked,n(1,s)}]}class Io extends hn{constructor(e){var t;super(),document.getElementById("svelte-hsd9fq-style")||((t=vt("style")).id="svelte-hsd9fq-style",t.textContent="li.svelte-hsd9fq{list-style:none;margin:none;margin-bottom:5px}h3.svelte-hsd9fq{text-transform:uppercase}label.svelte-hsd9fq{font-weight:bold;color:#999}input[type='checkbox'].svelte-hsd9fq{vertical-align:middle}",ht(document.head,t)),dn(this,e,Oo,Po,ot,{client:0})}}function Eo(e){let t,n,r,o,i,s;const a=new Cn({props:{panes:e[4],pane:e[1]}});a.$on("change",e[6]);var c=e[4][e[1]].component;function l(e){return{props:{client:e[0]}}}if(c)var u=new c(l(e));let p=e[3]&&Do(e);return{c(){t=vt("div"),ln(a.$$.fragment),n=xt(),r=vt("div"),u&&ln(u.$$.fragment),o=xt(),p&&p.c(),$t(r,"class","pane svelte-1h5kecx"),$t(t,"class","debug-panel svelte-1h5kecx")},m(e,i){yt(e,t,i),un(a,t,null),ht(t,n),ht(t,r),u&&un(u,r,null),ht(t,o),p&&p.m(t,null),s=!0},p(e,n){const o={};2&n&&(o.pane=e[1]),a.$set(o);const i={};if(1&n&&(i.client=e[0]),c!==(c=e[4][e[1]].component)){if(u){nn();const e=u;sn(e.$$.fragment,1,0,()=>{pn(e,1)}),rn()}c?(ln((u=new c(l(e))).$$.fragment),on(u.$$.fragment,1),un(u,r,null)):u=null}else c&&u.$set(i);e[3]?p?(p.p(e,n),on(p,1)):(p=Do(e),p.c(),on(p,1),p.m(t,null)):p&&(nn(),sn(p,1,1,()=>{p=null}),rn())},i(e){s||(on(a.$$.fragment,e),u&&on(u.$$.fragment,e),on(p),Jt(()=>{i||(i=cn(t,vn,{x:400},!0)),i.run(1)}),s=!0)},o(e){sn(a.$$.fragment,e),u&&sn(u.$$.fragment,e),sn(p),i||(i=cn(t,vn,{x:400},!1)),i.run(0),s=!1},d(e){e&&mt(t),pn(a),u&&pn(u),p&&p.d(),e&&i&&i.end()}}}function Do(e){let t,n;var r=e[3].component;function o(e){return{props:{metadata:e[3].metadata}}}if(r)var i=new r(o(e));return{c(){t=vt("div"),i&&ln(i.$$.fragment),$t(t,"class","secondary-pane svelte-1h5kecx")},m(e,r){yt(e,t,r),i&&un(i,t,null),n=!0},p(e,n){const s={};if(8&n&&(s.metadata=e[3].metadata),r!==(r=e[3].component)){if(i){nn();const e=i;sn(e.$$.fragment,1,0,()=>{pn(e,1)}),rn()}r?(ln((i=new r(o(e))).$$.fragment),on(i.$$.fragment,1),un(i,t,null)):i=null}else r&&i.$set(s)},i(e){n||(i&&on(i.$$.fragment,e),n=!0)},o(e){i&&sn(i.$$.fragment,e),n=!1},d(e){e&&mt(t),i&&pn(i)}}}function Ao(e){let t,n,r,o=e[2]&&Eo(e);return{c(){o&&o.c(),t=kt()},m(i,s,a){o&&o.m(i,s),yt(i,t,s),n=!0,a&&r(),r=Ct(window,"keypress",e[7])},p(e,[n]){e[2]?o?(o.p(e,n),on(o,1)):(o=Eo(e),o.c(),on(o,1),o.m(t.parentNode,t)):o&&(nn(),sn(o,1,1,()=>{o=null}),rn())},i(e){n||(on(o),n=!0)},o(e){sn(o),n=!1},d(e){o&&o.d(e),e&&mt(t),r()}}}function So(e,t,n){let r,{client:o}=t;const i={main:{label:"Main",shortcut:"m",component:er},log:{label:"Log",shortcut:"l",component:no},info:{label:"Info",shortcut:"i",component:ar},ai:{label:"AI",shortcut:"a",component:Io}},s=mn(!1),a=mn(null);st(e,a,e=>n(3,r=e)),Rt("hotkeys",{disableHotkeys:s}),Rt("secondaryPane",{secondaryPane:a});let c="main";let l=!0;return e.$set=e=>{"client"in e&&n(0,o=e.client)},[o,c,l,r,i,a,function(e){n(1,c=e.detail)},function(e){"."!=e.key?Object.entries(i).forEach(([t,{shortcut:r}])=>{e.key==r&&n(1,c=t)}):n(2,l=!l)}]}class _o extends hn{constructor(e){var t;super(),document.getElementById("svelte-1h5kecx-style")||((t=vt("style")).id="svelte-1h5kecx-style",t.textContent=".debug-panel.svelte-1h5kecx{position:fixed;color:#555;font-family:monospace;display:flex;flex-direction:row;text-align:left;right:0;top:0;height:100%;font-size:14px;box-sizing:border-box;opacity:0.9}.pane.svelte-1h5kecx{flex-grow:2;overflow-x:hidden;overflow-y:scroll;background:#fefefe;padding:20px;border-left:1px solid #ccc;box-shadow:-1px 0 5px rgba(0, 0, 0, 0.2);box-sizing:border-box;width:280px}.secondary-pane.svelte-1h5kecx{background:#fefefe;overflow-y:scroll}.debug-panel.svelte-1h5kecx button, select{cursor:pointer;outline:none;background:#eee;border:1px solid #bbb;color:#555;padding:3px;border-radius:3px}.debug-panel.svelte-1h5kecx button{padding-left:10px;padding-right:10px}.debug-panel.svelte-1h5kecx button:hover{background:#ddd}.debug-panel.svelte-1h5kecx button:active{background:#888;color:#fff}.debug-panel.svelte-1h5kecx section{margin-bottom:20px}",ht(document.head,t)),dn(this,e,So,Ao,ot,{client:0})}}function jo({game:e,numPlayers:t,setupData:n}){t||(t=2);let r={G:{},ctx:(e=Ye(e)).flow.ctx(t),plugins:{}};r=((e,t)=>([...Be,...t.game.plugins].filter(e=>void 0!==e.setup).forEach(n=>{const r=n.name,o=n.setup({G:e.G,ctx:e.ctx,game:t.game});e={...e,plugins:{...e.plugins,[r]:{data:o}}}}),e))(r,{game:e}),r=Te(r,{game:e,playerID:void 0});const o=Fe(r);r.G=e.setup(o,n);let i={...r,_undo:[],_redo:[],_stateID:0};return i=e.flow.init(i),i=Re(i,{game:e}),i}function No(e,t,n,r,o,i){return t.reduce((function(t,s){return t[s]=function(){var t=r;if(!i&&null==r){var a=n.getState();t=a.ctx.currentPlayer}for(var c=arguments.length,l=new Array(c),u=0;u<c;u++)l[u]=arguments[u];n.dispatch(z[e](s,l,t,o))},t}),{})}var Bo=No.bind(null,"makeMove"),Fo=No.bind(null,"gameEvent"),Mo=No.bind(null,"plugin"),To=function(){function e(t){var n=this,o=t.game,i=t.debug,s=t.numPlayers,a=t.multiplayer,c=t.gameID,l=t.playerID,u=t.credentials,p=t.enhancer;r(this,e),this.game=Ye(o),this.playerID=l,this.gameID=c,this.credentials=u,this.multiplayer=a,this.debug=i,this.gameStateOverride=null,this.subscribers={},this._running=!1,this.reducer=uo({game:this.game,isClient:void 0!==a,numPlayers:s}),this.initialState=null,a||(this.initialState=jo({game:this.game,numPlayers:s})),this.reset=function(){n.store.dispatch(B(n.initialState))},this.undo=function(){n.store.dispatch({type:"UNDO"})},this.redo=function(){n.store.dispatch({type:"REDO"})},this.store=null,this.log=[];var f=function(e){return function(t){return function(r){var o=t(r),i=e.getState();switch(r.type){case"MAKE_MOVE":case"GAME_EVENT":var s=i.deltalog;n.log=[].concat(m(n.log),m(s));break;case"RESET":n.log=[];break;case"UPDATE":var a=-1;n.log.length>0&&(a=n.log[n.log.length-1]._stateID);var c=r.deltalog||[];c=c.filter((function(e){return e._stateID>a})),n.log=[].concat(m(n.log),m(c));break;case"SYNC":n.initialState=r.initialState,n.log=r.log||[]}return o}}},d=function(e){return function(t){return function(r){var o=e.getState(),i=t(r);return 1!=r.clientOnly&&n.transport.onAction(o,r),i}}},h=function(){return function(e){return function(t){var r=e(t);return n.notifySubscribers(),r}}};p=void 0!==p?E(D(h,d,f),p):D(h,d,f),this.store=$(this.reducer,this.initialState,p),this.transport={isConnected:!0,onAction:function(){},subscribe:function(){},subscribeGameMetadata:function(e){},connect:function(){},disconnect:function(){},updateGameID:function(){},updatePlayerID:function(){}},a&&(this.transport=a({gameKey:o,game:this.game,store:this.store,gameID:c,playerID:l,gameName:this.game.name,numPlayers:s})),this.createDispatchers(),this.transport.subscribeGameMetadata((function(e){n.gameMetadata=e})),this._debugPanel=null}return i(e,[{key:"notifySubscribers",value:function(){var e=this;Object.values(this.subscribers).forEach((function(t){return t(e.getState())}))}},{key:"overrideGameState",value:function(e){this.gameStateOverride=e,this.notifySubscribers()}},{key:"start",value:function(){this.transport.connect(),this._running=!0;var e=null;if(e=_o,this.debug&&this.debug.impl&&(e=this.debug.impl),null!==e&&!1!==this.debug&&null==this._debugPanel&&"undefined"!=typeof document){var t=document.body;this.debug&&void 0!==this.debug.target&&(t=this.debug.target),t&&(this._debugPanel=new e({target:t,props:{client:this}}))}}},{key:"stop",value:function(){this.transport.disconnect(),this._running=!1,null!=this._debugPanel&&(this._debugPanel.$destroy(),this._debugPanel=null)}},{key:"subscribe",value:function(e){var t=this,n=Object.keys(this.subscribers).length;return this.subscribers[n]=e,this.transport.subscribe((function(){return t.notifySubscribers()})),!this._running&&this.multiplayer||e(this.getState()),function(){delete t.subscribers[n]}}},{key:"getInitialState",value:function(){return this.initialState}},{key:"getState",value:function(){var e=this.store.getState();if(null!==this.gameStateOverride&&(e=this.gameStateOverride),null===e)return e;var t=!0,n=this.game.flow.isPlayerActive(e.G,e.ctx,this.playerID);this.multiplayer&&!n&&(t=!1),this.multiplayer||null===this.playerID||void 0===this.playerID||n||(t=!1),void 0!==e.ctx.gameover&&(t=!1);var r=c({},e,{isActive:t,G:this.game.playerView(e.G,e.ctx,this.playerID),log:this.log});return r=c({},r,{isConnected:this.transport.isConnected})}},{key:"createDispatchers",value:function(){this.moves=Bo(this.game.moveNames,this.store,this.playerID,this.credentials,this.multiplayer),this.events=Fo(this.game.flow.enabledEventNames,this.store,this.playerID,this.credentials,this.multiplayer),this.plugins=Mo(this.game.pluginNames,this.store,this.playerID,this.credentials,this.multiplayer)}},{key:"updatePlayerID",value:function(e){this.playerID=e,this.createDispatchers(),this.transport.updatePlayerID(e),this.notifySubscribers()}},{key:"updateGameID",value:function(e){this.gameID=e,this.createDispatchers(),this.transport.updateGameID(e),this.notifySubscribers()}},{key:"updateCredentials",value:function(e){this.credentials=e,this.createDispatchers(),this.notifySubscribers()}}]),e}();function Ro(e){return new To(e)}var qo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function zo(e,t){return e(t={exports:{}},t.exports),t.exports
/** @license React v16.13.1
   * react-is.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   */}var Lo="function"==typeof Symbol&&Symbol.for,Uo=Lo?Symbol.for("react.element"):60103,Go=Lo?Symbol.for("react.portal"):60106,Ho=Lo?Symbol.for("react.fragment"):60107,Vo=Lo?Symbol.for("react.strict_mode"):60108,Jo=Lo?Symbol.for("react.profiler"):60114,Ko=Lo?Symbol.for("react.provider"):60109,Wo=Lo?Symbol.for("react.context"):60110,Yo=Lo?Symbol.for("react.async_mode"):60111,Xo=Lo?Symbol.for("react.concurrent_mode"):60111,Zo=Lo?Symbol.for("react.forward_ref"):60112,Qo=Lo?Symbol.for("react.suspense"):60113,ei=Lo?Symbol.for("react.suspense_list"):60120,ti=Lo?Symbol.for("react.memo"):60115,ni=Lo?Symbol.for("react.lazy"):60116,ri=Lo?Symbol.for("react.block"):60121,oi=Lo?Symbol.for("react.fundamental"):60117,ii=Lo?Symbol.for("react.responder"):60118,si=Lo?Symbol.for("react.scope"):60119;function ai(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case Uo:switch(e=e.type){case Yo:case Xo:case Ho:case Jo:case Vo:case Qo:return e;default:switch(e=e&&e.$$typeof){case Wo:case Zo:case ni:case ti:case Ko:return e;default:return t}}case Go:return t}}}function ci(e){return ai(e)===Xo}var li={AsyncMode:Yo,ConcurrentMode:Xo,ContextConsumer:Wo,ContextProvider:Ko,Element:Uo,ForwardRef:Zo,Fragment:Ho,Lazy:ni,Memo:ti,Portal:Go,Profiler:Jo,StrictMode:Vo,Suspense:Qo,isAsyncMode:function(e){return ci(e)||ai(e)===Yo},isConcurrentMode:ci,isContextConsumer:function(e){return ai(e)===Wo},isContextProvider:function(e){return ai(e)===Ko},isElement:function(e){return"object"==typeof e&&null!==e&&e.$$typeof===Uo},isForwardRef:function(e){return ai(e)===Zo},isFragment:function(e){return ai(e)===Ho},isLazy:function(e){return ai(e)===ni},isMemo:function(e){return ai(e)===ti},isPortal:function(e){return ai(e)===Go},isProfiler:function(e){return ai(e)===Jo},isStrictMode:function(e){return ai(e)===Vo},isSuspense:function(e){return ai(e)===Qo},isValidElementType:function(e){return"string"==typeof e||"function"==typeof e||e===Ho||e===Xo||e===Jo||e===Vo||e===Qo||e===ei||"object"==typeof e&&null!==e&&(e.$$typeof===ni||e.$$typeof===ti||e.$$typeof===Ko||e.$$typeof===Wo||e.$$typeof===Zo||e.$$typeof===oi||e.$$typeof===ii||e.$$typeof===si||e.$$typeof===ri)},typeOf:ai},ui=zo((function(e,t){})),pi=(ui.AsyncMode,ui.ConcurrentMode,ui.ContextConsumer,ui.ContextProvider,ui.Element,ui.ForwardRef,ui.Fragment,ui.Lazy,ui.Memo,ui.Portal,ui.Profiler,ui.StrictMode,ui.Suspense,ui.isAsyncMode,ui.isConcurrentMode,ui.isContextConsumer,ui.isContextProvider,ui.isElement,ui.isForwardRef,ui.isFragment,ui.isLazy,ui.isMemo,ui.isPortal,ui.isProfiler,ui.isStrictMode,ui.isSuspense,ui.isValidElementType,ui.typeOf,zo((function(e){e.exports=li})),Object.getOwnPropertySymbols),fi=Object.prototype.hasOwnProperty,di=Object.prototype.propertyIsEnumerable;function hi(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}})()&&Object.assign,Function.call.bind(Object.prototype.hasOwnProperty);function yi(){}function mi(){}mi.resetWarningCache=yi;var gi,vi=zo((function(e){e.exports=function(){function e(e,t,n,r,o,i){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:mi,resetWarningCache:yi};return n.PropTypes=n,n}()}));!function(e){e[e.SYNC=0]="SYNC",e[e.ASYNC=1]="ASYNC"}(gi||(gi={}));class bi extends class{type(){return gi.SYNC}connect(){}}{constructor(){super(),this.state=new Map,this.initial=new Map,this.metadata=new Map,this.log=new Map}createGame(e,t){this.initial.set(e,t.initialState),this.setState(e,t.initialState),this.setMetadata(e,t.metadata)}setMetadata(e,t){this.metadata.set(e,t)}setState(e,t,n){if(n&&n.length>0){const t=this.log.get(e)||[];this.log.set(e,t.concat(n))}this.state.set(e,t)}fetch(e,t){let n={};return t.state&&(n.state=this.state.get(e)),t.metadata&&(n.metadata=this.metadata.get(e)),t.log&&(n.log=this.log.get(e)||[]),t.initialState&&(n.initialState=this.initial.get(e)),n}wipe(e){this.state.delete(e),this.metadata.delete(e)}listGames(e){if(e&&void 0!==e.gameName){let t=[];return this.metadata.forEach((n,r)=>{n.gameName===e.gameName&&t.push(r)}),t}return[...this.metadata.keys()]}}const wi=(e,t)=>{if(e&&e.players)return e.players[t]};function xi(e){return e.type()===gi.SYNC}function ki(e,t){return void 0===e?e:e.map(e=>{if(null!==t&&+t==+e.action.payload.playerID)return e;if(!0!==e.redact)return e;const n={...e.action.payload,args:null},r={...e,action:{...e.action,payload:n}},{redact:o,...i}=r;return i})}const Ci=e=>{if(!e)return!1;const{players:t}=e;return Object.keys(t).some(e=>!(!t[e]||!t[e].credentials))},$i=(e,t)=>!!e&&(!!t&&e===t.credentials);class Pi{constructor(e,t,n,r){this.game=Ye(e),this.storageAPI=t,this.transportAPI=n,this.auth=null,this.subscribeCallback=()=>{},this.shouldAuth=()=>!1,!0===r?(this.auth=$i,this.shouldAuth=Ci):"function"==typeof r&&(this.auth=r,this.shouldAuth=()=>!0)}subscribe(e){this.subscribeCallback=e}async onUpdate(e,t,n,r){let o;const i="payload"in e&&"credentials"in e.payload?e.payload.credentials:void 0;if(xi(this.storageAPI)){const{metadata:e}=this.storageAPI.fetch(n,{metadata:!0}),t=wi(e,r);o=!this.shouldAuth(e)||this.auth(i,t)}else{const{metadata:e}=await this.storageAPI.fetch(n,{metadata:!0}),t=wi(e,r);o=!this.shouldAuth(e)||await this.auth(i,t)}if(!o)return{error:"unauthorized action"};e=(e=>{if("payload"in e&&"credentials"in e.payload){const{credentials:t,...n}=e.payload;return{...e,payload:n}}return e})(e);const s=n;let a,c;if(c=xi(this.storageAPI)?this.storageAPI.fetch(s,{state:!0}):await this.storageAPI.fetch(s,{state:!0}),a=c.state,void 0===a)return Le(`game not found, gameID=[${s}]`),{error:"game not found"};if(void 0!==a.ctx.gameover)return void Le(`game over - gameID=[${s}]`);const l=$(uo({game:this.game}),a);if(!("UNDO"!=e.type&&"REDO"!=e.type||a.ctx.currentPlayer===r&&null===a.ctx.activePlayers))return void Le(`playerID=[${r}] cannot undo / redo right now`);if(!this.game.flow.isPlayerActive(a.G,a.ctx,r))return void Le(`player not active - playerID=[${r}]`);if("MAKE_MOVE"==e.type&&!this.game.flow.getMove(a.ctx,e.payload.type,r))return void Le(`move not processed - canPlayerMakeMove=false, playerID=[${r}]`);a._stateID,l.dispatch(e),a=l.getState(),this.subscribeCallback({state:a,action:e,gameID:n}),this.transportAPI.sendAll(e=>{const t={...a,G:this.game.playerView(a.G,a.ctx,e),deltalog:void 0,_undo:[],_redo:[]},r=ki(a.deltalog,e);return{type:"update",args:[n,t,r]}});const{deltalog:u,...p}=a;xi(this.storageAPI)?this.storageAPI.setState(s,p,u):await this.storageAPI.setState(s,p,u)}async onSync(e,t,n){const r=e;let o,i,s,a,c,l;if(xi(this.storageAPI)){l=this.storageAPI.fetch(r,{state:!0,metadata:!0,log:!0,initialState:!0})}else l=await this.storageAPI.fetch(r,{state:!0,metadata:!0,log:!0,initialState:!0});if(o=l.state,i=l.initialState,s=l.log,a=l.metadata,a&&(c=Object.values(a.players).map(e=>({id:e.id,name:e.name}))),void 0===o)if(i=o=jo({game:this.game,numPlayers:n}),this.subscribeCallback({state:o,gameID:e}),xi(this.storageAPI)){this.storageAPI.setState(r,o)}else await this.storageAPI.setState(r,o);const u={...o,G:this.game.playerView(o.G,o.ctx,t),deltalog:void 0,_undo:[],_redo:[]};s=ki(s,t);const p={state:u,log:s,filteredMetadata:c,initialState:i};this.transportAPI.send({playerID:t,type:"sync",args:[e,p]})}}var Oi=function e(t){var n=t.store,o=t.gameName,i=t.playerID,s=t.gameID,a=t.numPlayers;r(this,e),this.store=n,this.gameName=o||"default",this.playerID=i||null,this.gameID=s||"default",this.numPlayers=a||2};function Ii(e){var t=e.game,n=e.bots,r={},o={};if(t&&t.ai&&n)for(var i in n){var s=n[i];o[i]=new s({game:t,enumerate:t.ai.enumerate,seed:t.seed})}var a=function(e){var t=e.type,n=e.playerID,o=e.args,i=r[n];void 0!==i&&i.apply(null,[t].concat(m(o)))},c=new Pi(t,new bi,{send:a,sendAll:function(e){for(var t in r){var n=e(t),o=n.type,i=n.args;a({type:o,playerID:t,args:i})}}},!1);return c.connect=function(e,t,n){r[t]=n},c.subscribe((function(e){var t=e.state,r=e.gameID;if(n){var i=function(e,t){if(void 0!==e.ctx.gameover)return null;if(e.ctx.stage)for(var n=0,r=Object.keys(t);n<r.length;n++){var o=r[n];if(o in e.ctx.stage)return o}else if(e.ctx.currentPlayer in t)return e.ctx.currentPlayer;return null}(t,o);null!==i&&setTimeout((async function(){var e=await o[i].play(t,i);await c.onUpdate(e.action,t._stateID,r,e.action.payload.playerID)}),100)}})),c}var Ei=function(e){l(n,e);var t=y(n);function n(e){var o,i=e.master,s=e.game,a=e.store,c=e.gameID,l=e.playerID,u=e.gameName,p=e.numPlayers;return r(this,n),(o=t.call(this,{store:a,gameName:u,playerID:l,gameID:c,numPlayers:p})).master=i,o.game=s,o.isConnected=!0,o}return i(n,[{key:"onUpdate",value:async function(e,t,n){var r=this.store.getState();if(e==this.gameID&&t._stateID>=r._stateID){var o=N(t,n);this.store.dispatch(o)}}},{key:"onSync",value:function(e,t){if(e==this.gameID){var n=j(t);this.store.dispatch(n)}}},{key:"onAction",value:function(e,t){this.master.onUpdate(t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;this.master.connect(this.gameID,this.playerID,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];"sync"==t&&e.onSync.apply(e,r),"update"==t&&e.onUpdate.apply(e,r)})),this.master.onSync(this.gameID,this.playerID,this.numPlayers)}},{key:"disconnect",value:function(){}},{key:"subscribe",value:function(){}},{key:"subscribeGameMetadata",value:function(e){}},{key:"updateGameID",value:function(e){this.gameID=e;var t=B(null);this.store.dispatch(t),this.connect()}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=B(null);this.store.dispatch(t),this.connect()}}]),n}(Oi),Di=new Map;var Ai=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Si=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],_i=function(e){var t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));for(var o=Ai.exec(e||""),i={},s=14;s--;)i[Si[s]]=o[s]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i},ji=1e3,Ni=6e4,Bi=60*Ni,Fi=24*Bi,Mi=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*Fi;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Bi;case"minutes":case"minute":case"mins":case"min":case"m":return n*Ni;case"seconds":case"second":case"secs":case"sec":case"s":return n*ji;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=Fi)return Ti(e,t,Fi,"day");if(t>=Bi)return Ti(e,t,Bi,"hour");if(t>=Ni)return Ti(e,t,Ni,"minute");if(t>=ji)return Ti(e,t,ji,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=Fi)return Math.round(e/Fi)+"d";if(t>=Bi)return Math.round(e/Bi)+"h";if(t>=Ni)return Math.round(e/Ni)+"m";if(t>=ji)return Math.round(e/ji)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Ti(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}var Ri=function(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){let i;function s(...e){if(!s.enabled)return;const t=s,r=Number(new Date),o=r-(i||r);t.diff=o,t.prev=i,t.curr=r,i=r,e[0]=n.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let a=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;a++;const i=n.formatters[o];if("function"==typeof i){const n=e[a];r=i.call(t,n),e.splice(a,1),a--}return r}),n.formatArgs.call(t,e),(t.log||n.log).apply(t,e)}return s.namespace=e,s.enabled=n.enabled(e),s.useColors=n.useColors(),s.color=t(e),s.destroy=r,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function r(){const e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function o(e,t){const r=n(this.namespace+(void 0===t?":":t)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){const e=[...n.names.map(i),...n.skips.map(i).map(e=>"-"+e)].join(",");return n.enable(""),e},n.enable=function(e){let t;n.save(e),n.names=[],n.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(t=0;t<o;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){const e=n.instances[t];e.enabled=n.enabled(e.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=Mi,Object.keys(e).forEach(t=>{n[t]=e[t]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},qi=zo((function(e,t){t.log=function(...e){return"object"==typeof console&&console.log&&console.log(...e)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))}),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=Ri(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),zi=(qi.log,qi.formatArgs,qi.save,qi.load,qi.useColors,qi.storage,qi.colors,qi("socket.io-client:url")),Li=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(zi("protocol-less url %s",e),e=void 0!==t?t.protocol+"//"+e:"https://"+e),zi("parse %s",e),n=_i(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n};var Ui=36e5,Gi=24*Ui,Hi=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*Gi;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Ui;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){return Vi(e,Gi,"day")||Vi(e,Ui,"hour")||Vi(e,6e4,"minute")||Vi(e,1e3,"second")||e+" ms"}(e):function(e){if(e>=Gi)return Math.round(e/Gi)+"d";if(e>=Ui)return Math.round(e/Ui)+"h";if(e>=6e4)return Math.round(e/6e4)+"m";if(e>=1e3)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Vi(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var Ji=zo((function(e,t){function n(e){var n;function o(){if(o.enabled){var e=o,r=+new Date,i=r-(n||r);e.diff=i,e.prev=n,e.curr=r,n=r;for(var s=new Array(arguments.length),a=0;a<s.length;a++)s[a]=arguments[a];s[0]=t.coerce(s[0]),"string"!=typeof s[0]&&s.unshift("%O");var c=0;s[0]=s[0].replace(/%([a-zA-Z%])/g,(function(n,r){if("%%"===n)return n;c++;var o=t.formatters[r];if("function"==typeof o){var i=s[c];n=o.call(e,i),s.splice(c,1),c--}return n})),t.formatArgs.call(e,s);var l=o.log||t.log||console.log.bind(console);l.apply(e,s)}}return o.namespace=e,o.enabled=t.enabled(e),o.useColors=t.useColors(),o.color=function(e){var n,r=0;for(n in e)r=(r<<5)-r+e.charCodeAt(n),r|=0;return t.colors[Math.abs(r)%t.colors.length]}(e),o.destroy=r,"function"==typeof t.init&&t.init(o),t.instances.push(o),o}function r(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}(t=e.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){var n;t.save(e),t.names=[],t.skips=[];var r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=Hi,t.instances=[],t.names=[],t.skips=[],t.formatters={}})),Ki=(Ji.coerce,Ji.disable,Ji.enable,Ji.enabled,Ji.humanize,Ji.instances,Ji.names,Ji.skips,Ji.formatters,zo((function(e,t){function n(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e}(t=e.exports=Ji).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),!n)return;var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))})),e.splice(i,0,r)},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=n,t.useColors=function(){if("undefined"!=typeof window&&window.process&&"renderer"===window.process.type)return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(n())}))),Wi=(Ki.log,Ki.formatArgs,Ki.save,Ki.load,Ki.useColors,Ki.storage,Ki.colors,zo((function(e){function t(e){if(e)return function(e){for(var n in t.prototype)e[n]=t.prototype[n];return e}(e)}e.exports=t,t.prototype.on=t.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},t.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},t.prototype.off=t.prototype.removeListener=t.prototype.removeAllListeners=t.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var o=0;o<r.length;o++)if((n=r[o])===t||n.fn===t){r.splice(o,1);break}return this},t.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var r=0,o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,t);return this},t.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},t.prototype.hasListeners=function(e){return!!this.listeners(e).length}}))),Yi={}.toString,Xi=Array.isArray||function(e){return"[object Array]"==Yi.call(e)},Zi=function(e){return Qi&&Buffer.isBuffer(e)||es&&(e instanceof ArrayBuffer||function(e){return"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer}(e))},Qi="function"==typeof Buffer&&"function"==typeof Buffer.isBuffer,es="function"==typeof ArrayBuffer;var ts=Object.prototype.toString,ns="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ts.call(Blob),rs="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ts.call(File);var os=function(e){var t=[],n=e.data,r=e;return r.data=function e(t,n){if(!t)return t;if(Zi(t)){var r={_placeholder:!0,num:n.length};return n.push(t),r}if(Xi(t)){for(var o=new Array(t.length),i=0;i<t.length;i++)o[i]=e(t[i],n);return o}if("object"==typeof t&&!(t instanceof Date)){o={};for(var s in t)o[s]=e(t[s],n);return o}return t}(n,t),r.attachments=t.length,{packet:r,buffers:t}},is=function(e,t){return e.data=function e(t,n){if(!t)return t;if(t&&t._placeholder)return n[t.num];if(Xi(t))for(var r=0;r<t.length;r++)t[r]=e(t[r],n);else if("object"==typeof t)for(var o in t)t[o]=e(t[o],n);return t}(e.data,t),e.attachments=void 0,e},ss=function(e,t){var n=0,r=e;!function e(o,i,s){if(!o)return o;if(ns&&o instanceof Blob||rs&&o instanceof File){n++;var a=new FileReader;a.onload=function(){s?s[i]=this.result:r=this.result,--n||t(r)},a.readAsArrayBuffer(o)}else if(Xi(o))for(var c=0;c<o.length;c++)e(o[c],c,o);else if("object"==typeof o&&!Zi(o))for(var l in o)e(o[l],l,o)}(r),n||t(r)},as=zo((function(e,t){var n=Ki("socket.io-parser");function r(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=r,t.Decoder=s;var o=t.ERROR+'"encode error"';function i(e){var r=""+e.type;if(t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(r+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(r+=e.nsp+","),null!=e.id&&(r+=e.id),null!=e.data){var i=function(e){try{return JSON.stringify(e)}catch(e){return!1}}(e.data);if(!1===i)return o;r+=i}return n("encoded %j as %s",e,r),r}function s(){this.reconstructor=null}function a(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}r.prototype.encode=function(e,r){(n("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type)?function(e,t){ss(e,(function(e){var n=os(e),r=i(n.packet),o=n.buffers;o.unshift(r),t(o)}))}(e,r):r([i(e)])},Wi(s.prototype),s.prototype.add=function(e){var r;if("string"==typeof e)r=function(e){var r=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return c("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var i="";"-"!==e.charAt(++r)&&(i+=e.charAt(r),r!=e.length););if(i!=Number(i)||"-"!==e.charAt(r))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===e.charAt(r+1))for(o.nsp="";++r;){if(","===(a=e.charAt(r)))break;if(o.nsp+=a,r===e.length)break}else o.nsp="/";var s=e.charAt(r+1);if(""!==s&&Number(s)==s){for(o.id="";++r;){var a;if(null==(a=e.charAt(r))||Number(a)!=a){--r;break}if(o.id+=e.charAt(r),r===e.length)break}o.id=Number(o.id)}if(e.charAt(++r)){var l=function(e){try{return JSON.parse(e)}catch(e){return!1}}(e.substr(r));if(!(!1!==l&&(o.type===t.ERROR||Xi(l))))return c("invalid payload");o.data=l}return n("decoded %s as %j",e,o),o}(e),t.BINARY_EVENT===r.type||t.BINARY_ACK===r.type?(this.reconstructor=new a(r),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",r)):this.emit("decoded",r);else{if(!Zi(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");(r=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",r))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=is(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}})),cs=(as.protocol,as.types,as.CONNECT,as.DISCONNECT,as.EVENT,as.ACK,as.ERROR,as.BINARY_EVENT,as.BINARY_ACK,as.Encoder,as.Decoder,zo((function(e){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}}))),ls=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||cs))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(e){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}},us=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t},ps={}.toString,fs=Array.isArray||function(e){return"[object Array]"==ps.call(e)},ds=Object.prototype.toString,hs="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ds.call(Blob),ys="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ds.call(File),ms=function e(t){if(!t||"object"!=typeof t)return!1;if(fs(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0;return!1}if("function"==typeof Buffer&&Buffer.isBuffer&&Buffer.isBuffer(t)||"function"==typeof ArrayBuffer&&t instanceof ArrayBuffer||hs&&t instanceof Blob||ys&&t instanceof File)return!0;if(t.toJSON&&"function"==typeof t.toJSON&&1===arguments.length)return e(t.toJSON(),!0);for(var o in t)if(Object.prototype.hasOwnProperty.call(t,o)&&e(t[o]))return!0;return!1};var gs=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(t<0&&(t+=r),n<0&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(n-t),s=t,a=0;s<n;s++,a++)i[a]=o[s];return i.buffer},vs=function(e,t,n){var r=!1;return n=n||bs,o.count=e,0===e?t():o;function o(e,i){if(o.count<=0)throw new Error("after called too many times");--o.count,e?(r=!0,t(e),t=n):0!==o.count||r||t(null,i)}};function bs(){}
/*! https://mths.be/utf8js v2.1.2 by @mathias */var ws,xs,ks,Cs=String.fromCharCode;function $s(e){for(var t,n,r=[],o=0,i=e.length;o<i;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<i?56320==(64512&(n=e.charCodeAt(o++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--):r.push(t);return r}function Ps(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Os(e,t){return Cs(e>>t&63|128)}function Is(e,t){if(0==(4294967168&e))return Cs(e);var n="";return 0==(4294965248&e)?n=Cs(e>>6&31|192):0==(4294901760&e)?(Ps(e,t)||(e=65533),n=Cs(e>>12&15|224),n+=Os(e,6)):0==(4292870144&e)&&(n=Cs(e>>18&7|240),n+=Os(e,12),n+=Os(e,6)),n+=Cs(63&e|128)}function Es(){if(ks>=xs)throw Error("Invalid byte index");var e=255&ws[ks];if(ks++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function Ds(e){var t,n;if(ks>xs)throw Error("Invalid byte index");if(ks==xs)return!1;if(t=255&ws[ks],ks++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|Es())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|Es()<<6|Es())>=2048)return Ps(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|Es()<<12|Es()<<6|Es())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}var As={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,r=$s(e),o=r.length,i=-1,s="";++i<o;)s+=Is(r[i],n);return s},decode:function(e,t){var n=!1!==(t=t||{}).strict;ws=$s(e),xs=ws.length,ks=0;for(var r,o=[];!1!==(r=Ds(n));)o.push(r);return function(e){for(var t,n=e.length,r=-1,o="";++r<n;)(t=e[r])>65535&&(o+=Cs((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=Cs(t);return o}(o)}},Ss=zo((function(e,t){!function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<e.length;r++)n[e.charCodeAt(r)]=r;t.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;n<o;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(e){var t,r,o,i,s,a=.75*e.length,c=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),p=new Uint8Array(u);for(t=0;t<c;t+=4)r=n[e.charCodeAt(t)],o=n[e.charCodeAt(t+1)],i=n[e.charCodeAt(t+2)],s=n[e.charCodeAt(t+3)],p[l++]=r<<2|o>>4,p[l++]=(15&o)<<4|i>>2,p[l++]=(3&i)<<6|63&s;return u}}()})),_s=(Ss.encode,Ss.decode,void 0!==_s?_s:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder),js=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),Ns=js&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),Bs=_s&&_s.prototype.append&&_s.prototype.getBlob;function Fs(e){return e.map((function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e}))}function Ms(e,t){t=t||{};var n=new _s;return Fs(e).forEach((function(e){n.append(e)})),t.type?n.getBlob(t.type):n.getBlob()}function Ts(e,t){return new Blob(Fs(e),t||{})}"undefined"!=typeof Blob&&(Ms.prototype=Blob.prototype,Ts.prototype=Blob.prototype);var Rs=js?Ns?Blob:Ts:Bs?Ms:void 0,qs=zo((function(e,t){var n;"undefined"!=typeof ArrayBuffer&&(n=Ss);var r="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),o="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),i=r||o;t.protocol=3;var s=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},a=us(s),c={type:"error",data:"parser error"};function l(e,t,n){for(var r=new Array(e.length),o=vs(e.length,n),i=function(e,n,o){t(n,(function(t,n){r[e]=n,o(t,r)}))},s=0;s<e.length;s++)i(s,e[s],o)}t.encodePacket=function(e,n,r,o){"function"==typeof n&&(o=n,n=!1),"function"==typeof r&&(o=r,r=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!=typeof ArrayBuffer&&a instanceof ArrayBuffer)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=e.data,i=new Uint8Array(o),a=new Uint8Array(1+o.byteLength);a[0]=s[e.type];for(var c=0;c<i.length;c++)a[c+1]=i[c];return r(a.buffer)}(e,n,o);if(void 0!==Rs&&a instanceof Rs)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);if(i)return function(e,n,r){if(!n)return t.encodeBase64Packet(e,r);var o=new FileReader;return o.onload=function(){t.encodePacket({type:e.type,data:o.result},n,!0,r)},o.readAsArrayBuffer(e.data)}(e,n,r);var o=new Uint8Array(1);o[0]=s[e.type];var a=new Rs([o.buffer,e.data]);return r(a)}(e,n,o);if(a&&a.base64)return function(e,n){var r="b"+t.packets[e.type]+e.data.data;return n(r)}(e,o);var c=s[e.type];return void 0!==e.data&&(c+=r?As.encode(String(e.data),{strict:!1}):String(e.data)),o(""+c)},t.encodeBase64Packet=function(e,n){var r,o="b"+t.packets[e.type];if(void 0!==Rs&&e.data instanceof Rs){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];n(o+e)},i.readAsDataURL(e.data)}try{r=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(t){for(var s=new Uint8Array(e.data),a=new Array(s.length),c=0;c<s.length;c++)a[c]=s[c];r=String.fromCharCode.apply(null,a)}return o+=btoa(r),n(o)},t.decodePacket=function(e,n,r){if(void 0===e)return c;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(r&&!1===(e=function(e){try{e=As.decode(e,{strict:!1})}catch(e){return!1}return e}(e)))return c;var o=e.charAt(0);return Number(o)==o&&a[o]?e.length>1?{type:a[o],data:e.substring(1)}:{type:a[o]}:c}o=new Uint8Array(e)[0];var i=gs(e,1);return Rs&&"blob"===n&&(i=new Rs([i])),{type:a[o],data:i}},t.decodeBase64Packet=function(e,t){var r=a[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var o=n.decode(e.substr(1));return"blob"===t&&Rs&&(o=new Rs([o])),{type:r,data:o}},t.encodePayload=function(e,n,r){"function"==typeof n&&(r=n,n=null);var o=ms(e);if(n&&o)return Rs&&!i?t.encodePayloadAsBlob(e,r):t.encodePayloadAsArrayBuffer(e,r);if(!e.length)return r("0:");l(e,(function(e,r){t.encodePacket(e,!!o&&n,!1,(function(e){r(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return r(t.join(""))}))},t.decodePayload=function(e,n,r){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,r);var o;if("function"==typeof n&&(r=n,n=null),""===e)return r(c,0,1);for(var i,s,a="",l=0,u=e.length;l<u;l++){var p=e.charAt(l);if(":"===p){if(""===a||a!=(i=Number(a)))return r(c,0,1);if(a!=(s=e.substr(l+1,i)).length)return r(c,0,1);if(s.length){if(o=t.decodePacket(s,n,!1),c.type===o.type&&c.data===o.data)return r(c,0,1);if(!1===r(o,l+i,u))return}l+=i,a=""}else a+=p}return""!==a?r(c,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){if(!e.length)return n(new ArrayBuffer(0));l(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){var r=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0),o=new Uint8Array(r),i=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);n=r.buffer}o[i++]=t?0:1;var a=n.byteLength.toString();for(s=0;s<a.length;s++)o[i++]=parseInt(a[s]);o[i++]=255;for(r=new Uint8Array(n),s=0;s<r.length;s++)o[i++]=r[s]})),n(o.buffer)}))},t.encodePayloadAsBlob=function(e,n){l(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);e=r.buffer,t[0]=0}var i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)s[o]=parseInt(i[o]);if(s[i.length]=255,Rs){var a=new Rs([t.buffer,s.buffer,e]);n(null,a)}}))}),(function(e,t){return n(new Rs(t))}))},t.decodePayloadAsBinary=function(e,n,r){"function"==typeof n&&(r=n,n=null);for(var o=e,i=[];o.byteLength>0;){for(var s=new Uint8Array(o),a=0===s[0],l="",u=1;255!==s[u];u++){if(l.length>310)return r(c,0,1);l+=s[u]}o=gs(o,2+l.length),l=parseInt(l);var p=gs(o,0,l);if(a)try{p=String.fromCharCode.apply(null,new Uint8Array(p))}catch(e){var f=new Uint8Array(p);p="";for(u=0;u<f.length;u++)p+=String.fromCharCode(f[u])}i.push(p),o=gs(o,l)}var d=i.length;i.forEach((function(e,o){r(t.decodePacket(e,n,!0),o,d)}))}})),zs=(qs.protocol,qs.packets,qs.encodePacket,qs.encodeBase64Packet,qs.decodePacket,qs.decodeBase64Packet,qs.encodePayload,qs.decodePayload,qs.encodePayloadAsArrayBuffer,qs.encodePayloadAsBlob,qs.decodePayloadAsBinary,Ls);function Ls(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}Wi(Ls.prototype),Ls.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},Ls.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},Ls.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},Ls.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},Ls.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},Ls.prototype.onData=function(e){var t=qs.decodePacket(e,this.socket.binaryType);this.onPacket(t)},Ls.prototype.onPacket=function(e){this.emit("packet",e)},Ls.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var Us,Gs=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},Hs=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;r<o;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t},Vs=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},Js="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),Ks={},Ws=0,Ys=0;function Xs(e){var t="";do{t=Js[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function Zs(){var e=Xs(+new Date);return e!==Us?(Ws=0,Us=e):e+"."+Xs(Ws++)}for(;Ys<64;Ys++)Ks[Js[Ys]]=Ys;Zs.encode=Xs,Zs.decode=function(e){var t=0;for(Ys=0;Ys<e.length;Ys++)t=64*t+Ks[e.charAt(Ys)];return t};var Qs=Zs,ea=qi("engine.io-client:polling"),ta=ra,na=null!=new ls({xdomain:!1}).responseType;function ra(e){var t=e&&e.forceBase64;na&&!t||(this.supportsBinary=!1),zs.call(this,e)}Vs(ra,zs),ra.prototype.name="polling",ra.prototype.doOpen=function(){this.poll()},ra.prototype.pause=function(e){var t=this;function n(){ea("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(ea("we are currently polling - waiting to pause"),r++,this.once("pollComplete",(function(){ea("pre-pause polling complete"),--r||n()}))),this.writable||(ea("we are currently writing - waiting to pause"),r++,this.once("drain",(function(){ea("pre-pause writing complete"),--r||n()})))}else n()},ra.prototype.poll=function(){ea("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},ra.prototype.onData=function(e){var t=this;ea("polling got data %s",e);qs.decodePayload(e,this.socket.binaryType,(function(e,n,r){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():ea('ignoring poll - transport state "%s"',this.readyState))},ra.prototype.doClose=function(){var e=this;function t(){ea("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(ea("transport open - closing"),t()):(ea("transport not open - deferring close"),this.once("open",t))},ra.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};qs.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},ra.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=Qs()),this.supportsBinary||e.sid||(e.b64=1),e=Gs(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e};var oa=qi("engine.io-client:polling-xhr"),ia=ca,sa=la;function aa(){}function ca(e){if(ta.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!=typeof location){var t="https:"===location.protocol,n=location.port;n||(n=t?443:80),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}}function la(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(Vs(ca,ta),ca.prototype.supportsBinary=!0,ca.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new la(e)},ca.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",(function(e){o.onError("xhr post error",e)})),this.sendXhr=r},ca.prototype.doPoll=function(){oa("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},Wi(la.prototype),la.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new ls(e),n=this;try{oa("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var r in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(r)&&t.setRequestHeader(r,this.extraHeaders[r])}catch(e){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{t.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){n.onLoad()},t.onerror=function(){n.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(n.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(e){}4===t.readyState&&(200===t.status||1223===t.status?n.onLoad():setTimeout((function(){n.onError("number"==typeof t.status?t.status:0)}),0))},oa("xhr data %s",this.data),t.send(this.data)}catch(e){return void setTimeout((function(){n.onError(e)}),0)}"undefined"!=typeof document&&(this.index=la.requestsCount++,la.requests[this.index]=this)},la.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},la.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},la.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},la.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=aa:this.xhr.onreadystatechange=aa,e)try{this.xhr.abort()}catch(e){}"undefined"!=typeof document&&delete la.requests[this.index],this.xhr=null}},la.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(e){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=e&&this.onData(e)},la.prototype.hasXDR=function(){return"undefined"!=typeof XDomainRequest&&!this.xs&&this.enablesXDR},la.prototype.abort=function(){this.cleanup()},la.requestsCount=0,la.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",pa);else if("function"==typeof addEventListener){var ua="onpagehide"in self?"pagehide":"unload";addEventListener(ua,pa,!1)}function pa(){for(var e in la.requests)la.requests.hasOwnProperty(e)&&la.requests[e].abort()}ia.Request=sa;var fa,da=va,ha=/\n/g,ya=/\\n/g;function ma(){}function ga(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==qo?qo:{}}function va(e){if(ta.call(this,e),this.query=this.query||{},!fa){var t=ga();fa=t.___eio=t.___eio||[]}this.index=fa.length;var n=this;fa.push((function(e){n.onData(e)})),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=ma)}),!1)}Vs(va,ta),va.prototype.supportsBinary=!1,va.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),ta.prototype.doClose.call(this)},va.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},va.prototype.doWrite=function(e,t){var n=this;if(!this.form){var r,o=document.createElement("form"),i=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;o.className="socketio",o.style.position="absolute",o.style.top="-1000px",o.style.left="-1000px",o.target=s,o.method="POST",o.setAttribute("accept-charset","utf-8"),i.name="d",o.appendChild(i),document.body.appendChild(o),this.form=o,this.area=i}function a(){c(),t()}function c(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(e){n.onError("jsonp polling iframe removal error",e)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';r=document.createElement(e)}catch(e){(r=document.createElement("iframe")).name=n.iframeId,r.src="javascript:0"}r.id=n.iframeId,n.form.appendChild(r),n.iframe=r}this.form.action=this.uri(),c(),e=e.replace(ya,"\\\n"),this.area.value=e.replace(ha,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&a()}:this.iframe.onload=a};var ba,wa,xa=qi("engine.io-client:websocket");if("undefined"!=typeof WebSocket?ba=WebSocket:"undefined"!=typeof self&&(ba=self.WebSocket||self.MozWebSocket),"undefined"==typeof window)try{wa={}}catch(Ho){}var ka=ba||wa,Ca=$a;function $a(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=ba&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(ka=wa),zs.call(this,e)}Vs($a,zs),$a.prototype.name="websocket",$a.prototype.supportsBinary=!0,$a.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new ka(e,t):new ka(e):new ka(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},$a.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},$a.prototype.write=function(e){var t=this;this.writable=!1;for(var n=e.length,r=0,o=n;r<o;r++)!function(e){qs.encodePacket(e,t.supportsBinary,(function(r){if(!t.usingBrowserWebSocket){var o={};if(e.options&&(o.compress=e.options.compress),t.perMessageDeflate)("string"==typeof r?Buffer.byteLength(r):r.length)<t.perMessageDeflate.threshold&&(o.compress=!1)}try{t.usingBrowserWebSocket?t.ws.send(r):t.ws.send(r,o)}catch(e){xa("websocket closed before onclose event")}--n||i()}))}(e[r]);function i(){t.emit("flush"),setTimeout((function(){t.writable=!0,t.emit("drain")}),0)}},$a.prototype.onClose=function(){zs.prototype.onClose.call(this)},$a.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},$a.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=Qs()),this.supportsBinary||(e.b64=1),(e=Gs(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},$a.prototype.check=function(){return!(!ka||"__initialize"in ka&&this.name===$a.prototype.name)};var Pa={polling:function(e){var t=!1,n=!1,r=!1!==e.jsonp;if("undefined"!=typeof location){var o="https:"===location.protocol,i=location.port;i||(i=o?443:80),t=e.hostname!==location.hostname||i!==e.port,n=e.secure!==o}if(e.xdomain=t,e.xscheme=n,"open"in new ls(e)&&!e.forceJSONP)return new ia(e);if(!r)throw new Error("JSONP disabled");return new da(e)},websocket:Ca},Oa=[].indexOf,Ia=function(e,t){if(Oa)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1},Ea=qi("engine.io-client:socket"),Da=Aa;function Aa(e,t){if(!(this instanceof Aa))return new Aa(e,t);t=t||{},e&&"object"==typeof e&&(t=e,e=null),e?(e=_i(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=_i(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=Hs(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}Aa.priorWebsocketSuccess=!1,Wi(Aa.prototype),Aa.protocol=qs.protocol,Aa.Socket=Aa,Aa.Transport=zs,Aa.transports=Pa,Aa.parser=qs,Aa.prototype.createTransport=function(e){Ea('creating transport "%s"',e);var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=qs.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new Pa[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,withCredentials:n.withCredentials||this.withCredentials,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},Aa.prototype.open=function(){var e;if(this.rememberUpgrade&&Aa.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},Aa.prototype.setTransport=function(e){Ea("setting transport %s",e.name);var t=this;this.transport&&(Ea("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},Aa.prototype.probe=function(e){Ea('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),n=!1,r=this;function o(){if(r.onlyBinaryUpgrades){var o=!this.supportsBinary&&r.transport.supportsBinary;n=n||o}n||(Ea('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(o){if(!n)if("pong"===o.type&&"probe"===o.data){if(Ea('probe transport "%s" pong',e),r.upgrading=!0,r.emit("upgrading",t),!t)return;Aa.priorWebsocketSuccess="websocket"===t.name,Ea('pausing current transport "%s"',r.transport.name),r.transport.pause((function(){n||"closed"!==r.readyState&&(Ea("changing transport and sending upgrade packet"),u(),r.setTransport(t),t.send([{type:"upgrade"}]),r.emit("upgrade",t),t=null,r.upgrading=!1,r.flush())}))}else{Ea('probe transport "%s" failed',e);var i=new Error("probe error");i.transport=t.name,r.emit("upgradeError",i)}})))}function i(){n||(n=!0,u(),t.close(),t=null)}function s(n){var o=new Error("probe error: "+n);o.transport=t.name,i(),Ea('probe transport "%s" failed because of error: %s',e,n),r.emit("upgradeError",o)}function a(){s("transport closed")}function c(){s("socket closed")}function l(e){t&&e.name!==t.name&&(Ea('"%s" works - aborting "%s"',e.name,t.name),i())}function u(){t.removeListener("open",o),t.removeListener("error",s),t.removeListener("close",a),r.removeListener("close",c),r.removeListener("upgrading",l)}Aa.priorWebsocketSuccess=!1,t.once("open",o),t.once("error",s),t.once("close",a),this.once("close",c),this.once("upgrading",l),t.open()},Aa.prototype.onOpen=function(){if(Ea("socket open"),this.readyState="open",Aa.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){Ea("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},Aa.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(Ea('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else Ea('packet received with socket readyState "%s"',this.readyState)},Aa.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},Aa.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},Aa.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){Ea("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},Aa.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},Aa.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},Aa.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(Ea("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},Aa.prototype.write=Aa.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},Aa.prototype.sendPacket=function(e,t,n,r){if("function"==typeof t&&(r=t,t=void 0),"function"==typeof n&&(r=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var o={type:e,data:t,options:n};this.emit("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}},Aa.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?r():t()})):this.upgrading?r():t()}function t(){e.onClose("forced close"),Ea("socket closing - telling transport to close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function r(){e.once("upgrade",n),e.once("upgradeError",n)}return this},Aa.prototype.onError=function(e){Ea("socket error %j",e),Aa.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},Aa.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){Ea('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},Aa.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;n<r;n++)~Ia(this.transports,e[n])&&t.push(e[n]);return t};var Sa=Da,_a=qs;Sa.parser=_a;var ja=function(e,t){for(var n=[],r=(t=t||0)||0;r<e.length;r++)n[r-t]=e[r];return n};var Na=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}};var Ba=[].slice,Fa=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=Ba.call(arguments,2);return function(){return t.apply(e,n.concat(Ba.call(arguments)))}},Ma=zo((function(e,t){var n=qi("socket.io-client:socket");e.exports=i;var r={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},o=Wi.prototype.emit;function i(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}Wi(i.prototype),i.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[Na(e,"open",Fa(this,"onopen")),Na(e,"packet",Fa(this,"onpacket")),Na(e,"close",Fa(this,"onclose"))]}},i.prototype.open=i.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting")),this},i.prototype.send=function(){var e=ja(arguments);return e.unshift("message"),this.emit.apply(this,e),this},i.prototype.emit=function(e){if(r.hasOwnProperty(e))return o.apply(this,arguments),this;var t=ja(arguments),i={type:(void 0!==this.flags.binary?this.flags.binary:ms(t))?as.BINARY_EVENT:as.EVENT,data:t,options:{}};return i.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(n("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),i.id=this.ids++),this.connected?this.packet(i):this.sendBuffer.push(i),this.flags={},this},i.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},i.prototype.onopen=function(){if(n("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"==typeof this.query?Gs(this.query):this.query;n("sending connect packet with query %s",e),this.packet({type:as.CONNECT,query:e})}else this.packet({type:as.CONNECT})},i.prototype.onclose=function(e){n("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},i.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===as.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case as.CONNECT:this.onconnect();break;case as.EVENT:case as.BINARY_EVENT:this.onevent(e);break;case as.ACK:case as.BINARY_ACK:this.onack(e);break;case as.DISCONNECT:this.ondisconnect();break;case as.ERROR:this.emit("error",e.data)}},i.prototype.onevent=function(e){var t=e.data||[];n("emitting event %j",t),null!=e.id&&(n("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?o.apply(this,t):this.receiveBuffer.push(t)},i.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var o=ja(arguments);n("sending ack %j",o),t.packet({type:ms(o)?as.BINARY_ACK:as.ACK,id:e,data:o})}}},i.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(n("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):n("bad ack %s",e.id)},i.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},i.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)o.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},i.prototype.ondisconnect=function(){n("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},i.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},i.prototype.close=i.prototype.disconnect=function(){return this.connected&&(n("performing disconnect (%s)",this.nsp),this.packet({type:as.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},i.prototype.compress=function(e){return this.flags.compress=e,this},i.prototype.binary=function(e){return this.flags.binary=e,this}})),Ta=Ra;function Ra(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Ra.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Ra.prototype.reset=function(){this.attempts=0},Ra.prototype.setMin=function(e){this.ms=e},Ra.prototype.setMax=function(e){this.max=e},Ra.prototype.setJitter=function(e){this.jitter=e};var qa=qi("socket.io-client:manager"),za=Object.prototype.hasOwnProperty,La=Ua;function Ua(e,t){if(!(this instanceof Ua))return new Ua(e,t);e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new Ta({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||as;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}Ua.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)za.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},Ua.prototype.updateSocketIds=function(){for(var e in this.nsps)za.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},Ua.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},Wi(Ua.prototype),Ua.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},Ua.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},Ua.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},Ua.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},Ua.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},Ua.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},Ua.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},Ua.prototype.open=Ua.prototype.connect=function(e,t){if(qa("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;qa("opening %s",this.uri),this.engine=Sa(this.uri,this.opts);var n=this.engine,r=this;this.readyState="opening",this.skipReconnect=!1;var o=Na(n,"open",(function(){r.onopen(),e&&e()})),i=Na(n,"error",(function(t){if(qa("connect_error"),r.cleanup(),r.readyState="closed",r.emitAll("connect_error",t),e){var n=new Error("Connection error");n.data=t,e(n)}else r.maybeReconnectOnOpen()}));if(!1!==this._timeout){var s=this._timeout;qa("connect attempt will timeout after %d",s);var a=setTimeout((function(){qa("connect attempt timed out after %d",s),o.destroy(),n.close(),n.emit("error","timeout"),r.emitAll("connect_timeout",s)}),s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(o),this.subs.push(i),this},Ua.prototype.onopen=function(){qa("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(Na(e,"data",Fa(this,"ondata"))),this.subs.push(Na(e,"ping",Fa(this,"onping"))),this.subs.push(Na(e,"pong",Fa(this,"onpong"))),this.subs.push(Na(e,"error",Fa(this,"onerror"))),this.subs.push(Na(e,"close",Fa(this,"onclose"))),this.subs.push(Na(this.decoder,"decoded",Fa(this,"ondecoded")))},Ua.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},Ua.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},Ua.prototype.ondata=function(e){this.decoder.add(e)},Ua.prototype.ondecoded=function(e){this.emit("packet",e)},Ua.prototype.onerror=function(e){qa("error",e),this.emitAll("error",e)},Ua.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new Ma(this,e,t),this.nsps[e]=n;var r=this;n.on("connecting",o),n.on("connect",(function(){n.id=r.generateId(e)})),this.autoConnect&&o()}function o(){~Ia(r.connecting,n)||r.connecting.push(n)}return n},Ua.prototype.destroy=function(e){var t=Ia(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},Ua.prototype.packet=function(e){qa("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var r=0;r<n.length;r++)t.engine.write(n[r],e.options);t.encoding=!1,t.processPacketQueue()})))},Ua.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},Ua.prototype.cleanup=function(){qa("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},Ua.prototype.close=Ua.prototype.disconnect=function(){qa("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},Ua.prototype.onclose=function(e){qa("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},Ua.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)qa("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();qa("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(qa("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(qa("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(qa("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},Ua.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)};var Ga=zo((function(e,t){var n=qi("socket.io-client");e.exports=t=o;var r=t.managers={};function o(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var o,i=Li(e),s=i.source,a=i.id,c=i.path,l=r[a]&&c in r[a].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||l?(n("ignoring socket cache for %s",s),o=La(s,t)):(r[a]||(n("new io instance for %s",s),r[a]=La(s,t)),o=r[a]),i.query&&!t.query&&(t.query=i.query),o.socket(i.path,t)}t.protocol=as.protocol,t.connect=o,t.Manager=La,t.Socket=Ma})),Ha=(Ga.managers,Ga.protocol,Ga.connect,Ga.Manager,Ga.Socket,function(e){l(n,e);var t=y(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=o.socket,s=o.socketOpts,a=o.store,c=o.gameID,l=o.playerID,u=o.gameName,p=o.numPlayers,f=o.server;return r(this,n),(e=t.call(this,{store:a,gameName:u,playerID:l,gameID:c,numPlayers:p})).server=f,e.socket=i,e.socketOpts=s,e.isConnected=!1,e.callback=function(){},e.gameMetadataCallback=function(){},e}return i(n,[{key:"onAction",value:function(e,t){this.socket.emit("update",t,e._stateID,this.gameID,this.playerID)}},{key:"connect",value:function(){var e=this;if(!this.socket)if(this.server){var t=this.server;-1==t.search(/^https?:\/\//)&&(t="http://"+this.server),"/"!=t.substr(-1)&&(t+="/"),this.socket=Ga(t+this.gameName,this.socketOpts)}else this.socket=Ga("/"+this.gameName,this.socketOpts);this.socket.on("update",(function(t,n,r){var o=e.store.getState();if(t==e.gameID&&n._stateID>=o._stateID){var i=N(n,r);e.store.dispatch(i)}})),this.socket.on("sync",(function(t,n){if(t==e.gameID){var r=j(n);e.gameMetadataCallback(n.filteredMetadata),e.store.dispatch(r)}})),this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers),this.socket.on("connect",(function(){e.isConnected=!0,e.callback()})),this.socket.on("disconnect",(function(){e.isConnected=!1,e.callback()}))}},{key:"disconnect",value:function(){this.socket.close(),this.socket=null,this.isConnected=!1,this.callback()}},{key:"subscribe",value:function(e){this.callback=e}},{key:"subscribeGameMetadata",value:function(e){this.gameMetadataCallback=e}},{key:"updateGameID",value:function(e){this.gameID=e;var t=B(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}},{key:"updatePlayerID",value:function(e){this.playerID=e;var t=B(null);this.store.dispatch(t),this.socket&&this.socket.emit("sync",this.gameID,this.playerID,this.numPlayers)}}]),n}(Oi));e.Client=Ro,e.Local=function(e){return function(t){var n;return Di.has(t.gameKey)&!e?n=Di.get(t.gameKey):(n=new Ii({game:t.game,bots:e&&e.bots}),Di.set(t.gameKey,n)),new Ei(c({master:n},t))}},e.MCTSBot=fo,e.RandomBot=ho,e.ReactClient=function(e){var n,o,a=e.game,u=e.numPlayers,p=e.loading,f=e.board,d=e.multiplayer,h=e.enhancer,m=e.debug;if(void 0===p){p=function(){return t.createElement("div",{className:"bgio-loading"},"connecting...")}}return o=n=function(e){l(o,e);var n=y(o);function o(e){var t;return r(this,o),t=n.call(this,e),void 0===m&&(m=e.debug),t.client=Ro({game:a,debug:m,numPlayers:u,multiplayer:d,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,enhancer:h}),t}return i(o,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribe=this.client.subscribe((function(){return e.forceUpdate()})),this.client.start()}},{key:"componentWillUnmount",value:function(){this.client.stop(),this.unsubscribe()}},{key:"componentDidUpdate",value:function(e){this.props.gameID!=e.gameID&&this.client.updateGameID(this.props.gameID),this.props.playerID!=e.playerID&&this.client.updatePlayerID(this.props.playerID),this.props.credentials!=e.credentials&&this.client.updateCredentials(this.props.credentials)}},{key:"render",value:function(){var e=this.client.getState();if(null===e)return t.createElement(p);var n=null;return f&&(n=t.createElement(f,c({},e,{},this.props,{isMultiplayer:!!d,moves:this.client.moves,events:this.client.events,gameID:this.client.gameID,playerID:this.client.playerID,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,gameMetadata:this.client.gameMetadata}))),t.createElement("div",{className:"bgio-client"},n)}}]),o}(t.Component),s(n,"propTypes",{gameID:vi.string,playerID:vi.string,credentials:vi.string,debug:vi.any}),s(n,"defaultProps",{gameID:"default",playerID:null,credentials:null,debug:!0}),o},e.ReactNativeClient=function(e){var n,o,a=e.game,u=e.numPlayers,p=e.board,f=e.multiplayer,h=e.enhancer;return o=n=function(e){l(o,e);var n=y(o);function o(e){var t;return r(this,o),(t=n.call(this,e)).client=Ro({game:a,numPlayers:u,multiplayer:f,gameID:e.gameID,playerID:e.playerID,credentials:e.credentials,debug:!1,enhancer:h}),t}return i(o,[{key:"componentDidMount",value:function(){var e=this;this.unsubscribe=this.client.subscribe((function(){return e.forceUpdate()})),this.client.start()}},{key:"componentWillUnmount",value:function(){this.client.stop(),this.unsubscribe()}},{key:"componentDidUpdate",value:function(e){e.gameID!=this.props.gameID&&this.client.updateGameID(this.props.gameID),e.playerID!=this.props.playerID&&this.client.updatePlayerID(this.props.playerID),e.credentials!=this.props.credentials&&this.client.updateCredentials(this.props.credentials)}},{key:"render",value:function(){var e=null,n=this.client.getState(),r=this.props,o=r.gameID,i=r.playerID,s=d(r,["gameID","playerID"]);return p&&(e=t.createElement(p,c({},n,{},s,{gameID:o,playerID:i,isMultiplayer:!!f,moves:this.client.moves,events:this.client.events,step:this.client.step,reset:this.client.reset,undo:this.client.undo,redo:this.client.redo,gameMetadata:this.client.gameMetadata}))),e}}]),o}(t.Component),s(n,"propTypes",{gameID:vi.string,playerID:vi.string,credentials:vi.string}),s(n,"defaultProps",{gameID:"default",playerID:null,credentials:null}),o},e.Simulate=async function(e){var t=e.game,n=e.bots,r=e.state,o=e.depth;void 0===o&&(o=1e4);for(var i=uo({game:t,numPlayers:r.ctx.numPlayers}),s=null,a=0;void 0===r.ctx.gameover&&a<o;){var c=r.ctx.currentPlayer;r.ctx.activePlayers&&(c=Object.keys(r.ctx.activePlayers)[0]);var l=n instanceof po?n:n[c],u=await l.play(r,c);if(!u.action)break;s=u.metadata,r=i(r,u.action),a++}return{state:r,metadata:s}},e.SocketIO=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.server,n=e.socketOpts;return function(e){return new Ha(c({server:t,socketOpts:n},e))}},e.Step=yo,e.TurnOrder=Je,Object.defineProperty(e,"__esModule",{value:!0})}));
